#! encoding="UTF-8"
#    Command-line to run this workspace:
#        C:\apps\FME\fme.exe C:\Users\natal\Desktop\FME1\cw2\Sentinel.fme
#              --email_host ""
#              --haslo "********"
#              --email_klient ""
#              --powiat ""
#              --pokrycie_chmurami ""
#              --data_poczatkowa ""
#              --data_koncowa ""
#              --SourceDataset_SHAPEFILE "C:\Users\natal\Downloads\BDP-CW_10_FME_Sentinel2\Powiaty\Powiaty.shp"
#              --DestDataset_CSV2 "E:\Studia\Bazy_danych_przestrzennych\FME_2"
#              --DestDataset_TIFF "E:\Studia\Bazy_danych_przestrzennych\FME_2"
#    
FME_PYTHON_VERSION 37
GUI IGNORE SourceDataset_SHAPEFILE_1,SHAPEFILE_IN_READER_PARAMETERS_SHAPEFILE_1,SHAPEFILE_IN_ENCODING_SHAPEFILE_1,SHAPEFILE_IN_USE_SEARCH_ENVELOPE_SHAPEFILE_1,SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1,SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1,SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1,SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1,SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1,SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1,SHAPEFILE_IN_ADVANCED_SHAPEFILE_1,SHAPEFILE_IN_TRIM_PRECEDING_SPACES_SHAPEFILE_1,SHAPEFILE_IN_READ_BLANK_AS_SHAPEFILE_1,SHAPEFILE_IN_DONUT_DETECTION_SHAPEFILE_1,SHAPEFILE_IN_MEASURES_AS_Z_SHAPEFILE_1,SHAPEFILE_IN_REPORT_BAD_GEOMETRY_SHAPEFILE_1,SHAPEFILE_IN_NETWORK_AUTHENTICATION_SHAPEFILE_1,DestDataset_CSV2_1,CSV2_OUT_DATASET_GROUP_CSV2_1,CSV2_OUT_EXTENSION_CSV2_1,CSV2_OUT_FIELDS_GROUP_CSV2_1,CSV2_OUT_DELIMITER_CSV2_1,CSV2_OUT_ENCODING_GROUP_CSV2_1,CSV2_OUT_ENCODING_CSV2_1,CSV2_OUT_WRITE_BOM_FOR_UNICODE_CSV2_1,CSV2_OUT_ADVANCED_GROUP_CSV2_1,CSV2_OUT_QUALIFY_FIELD_NAMES_CSV2_1,CSV2_OUT_QUALIFY_FIELD_VALUES_CSV2_1,CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1,CSV2_OUT_FIELD_QUALIFIER_CHARACTER_CSV2_1,CSV2_OUT_FIELD_QUALIFIER_ESCAPE_CHARACTER_CSV2_1,CSV2_OUT_ROW_TERMINATION_CSV2_1,CSV2_OUT_WRITE_SCHEMA_FILE_CSV2_1,CSV2_OUT_EXISTING_SCHEMA_FILE_HANDLING_CSV2_1,DestDataset_TIFF_1
DEFAULT_MACRO email_host 
GUI TEXT email_host Adres e-mail:
DEFAULT_MACRO haslo 
GUI PASSWORD haslo Hasło:
DEFAULT_MACRO email_klient 
GUI TEXT email_klient Adres e-mail klienta:
DEFAULT_MACRO powiat 
GUI TEXT powiat Powiat:
DEFAULT_MACRO pokrycie_chmurami 
GUI OPTIONAL RANGE_SLIDER pokrycie_chmurami "RANGE:[,]" Maksymalne pokrycie chmurami:
DEFAULT_MACRO data_poczatkowa 
GUI OPTIONAL DATE data_poczatkowa "{}" Data początkowa:
DEFAULT_MACRO data_koncowa 
GUI OPTIONAL DATE data_koncowa "{}" Data końcowa:
DEFAULT_MACRO SourceDataset_SHAPEFILE $(FME_MF_DIR)Powiaty\Powiaty.shp
GUI MULTIFILE SourceDataset_SHAPEFILE Shapefiles(*.shp)|*.shp|Compressed_Shapefiles(*.shz)|*.shz|Compressed_Files(*.bz2;*.gz)|*.bz2;*.gz|Archive_Files(*.7z;*.7zip;*.rar;*.rvz;*.tar;*.tar.bz2;*.tar.gz;*.tgz;*.zip;*.zipx)|*.7z;*.7zip;*.rar;*.rvz;*.tar;*.tar.bz2;*.tar.gz;*.tgz;*.zip;*.zipx|All_Files(*)|* Source Esri Shapefile(s):
DEFAULT_MACRO DestDataset_CSV2 E:\Studia\Bazy_danych_przestrzennych\FME_2
GUI DIRNAME DestDataset_CSV2 Destination CSV (Comma Separated Value) Folder:
DEFAULT_MACRO DestDataset_TIFF E:\Studia\Bazy_danych_przestrzennych\FME_2
GUI DIRNAME DestDataset_TIFF Destination TIFF (Tagged Image File Format) Folder:
INCLUDE [ if {{$(email_host)} == {}} { puts_real {Parameter 'email_host' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(haslo)} == {}} { puts_real {Parameter 'haslo' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(email_klient)} == {}} { puts_real {Parameter 'email_klient' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(powiat)} == {}} { puts_real {Parameter 'powiat' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(SourceDataset_SHAPEFILE)} == {}} { puts_real {Parameter 'SourceDataset_SHAPEFILE' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(DestDataset_CSV2)} == {}} { puts_real {Parameter 'DestDataset_CSV2' must be given a value.}; exit 1; }; ]
INCLUDE [ if {{$(DestDataset_TIFF)} == {}} { puts_real {Parameter 'DestDataset_TIFF' must be given a value.}; exit 1; }; ]
READER_TYPE MULTI_READER
MULTI_READER_TYPE{0} SHAPEFILE
MULTI_READER_KEYWORD{0} SHAPEFILE_1
MULTI_READER_GEN_DIRECTIVES{0} SEARCH_ENVELOPE_MINX,0,ENCODING,fme-source-encoding,USE_SEARCH_ENVELOPE,NO,REPORT_BAD_GEOMETRY,No,MEASURES_AS_Z,No,DONUT_DETECTION,ORIENTATION,SEARCH_ENVELOPE_COORDINATE_SYSTEM,,SHAPEFILE_EXPOSE_FORMAT_ATTRS,,TRIM_PRECEDING_SPACES,Yes,SEARCH_ENVELOPE_MAXX,0,SEARCH_ENVELOPE_MINY,0,SEARCH_ENVELOPE_MAXY,0,READ_BLANK_AS,MISSING,CLIP_TO_ENVELOPE,NO,EXPOSE_ATTRS_GROUP,,ADVANCED,,NUMERIC_TYPE_ATTRIBUTE_HANDLING,STANDARD_TYPES,_MERGE_SCHEMAS,YES
WRITER_TYPE MULTI_WRITER
MULTI_WRITER_DATASET_ORDER BY_ID
MULTI_WRITER_FIRST_WRITER_ID 0
MULTI_WRITER_TYPE{0} CSV2
MULTI_WRITER_KEYWORD{0} CSV2_1
MULTI_WRITER_TYPE{1} TIFF
MULTI_WRITER_KEYWORD{1} TIFF_1
MACRO WB_KEYWORD "SHAPEFILE_1"
# ============================================================================
# The following GUI line prompts for the source shapefiles
# The dataset this mapping file was generated from was:
DEFAULT_MACRO SourceDataset
INCLUDE [ if {{$(SourceDataset)} != ""} {                        \
 puts {DEFAULT_MACRO SourceDataset_SHAPEFILE_1 $(SourceDataset)}     \
 } ]
DEFAULT_MACRO SourceDataset_SHAPEFILE_1 $(SourceDataset_SHAPEFILE)
GUI MULTIFILE SourceDataset_SHAPEFILE_1 Shapefiles(*.shp)|*.shp|Compressed_Shapefiles(*.shz)|*.shz|All_Files(*)|* Source Esri Shapefile(s):
DEFAULT_MACRO SHAPEFILE_IN_READER_PARAMETERS_SHAPEFILE_1 
GUI OPTIONAL DISCLOSUREGROUP SHAPEFILE_IN_READER_PARAMETERS_SHAPEFILE_1 SHAPEFILE_IN_ENCODING_SHAPEFILE_1%SHAPEFILE_IN_NUMERIC_TYPE_ATTRIBUTE_HANDLING Reader Parameters
# ============================================================================
# The following keyword allows the user to choose what encoding to
# use for reading the shapefile, overrides dbf file LDID or .cpg
# file if present.
DEFAULT_MACRO SHAPEFILE_IN_ENCODING_SHAPEFILE_1 fme-source-encoding
SHAPEFILE_1_ENCODING "$(SHAPEFILE_IN_ENCODING_SHAPEFILE_1)"
GUI STRING_OR_ENCODING SHAPEFILE_IN_ENCODING_SHAPEFILE_1 fme-source-encoding%UTF-8%ISO*%Big5%ibm*%Shift_JIS%GB2312%GBK%win*%KSC_5601%macintosh%x-mac* Character Encoding
# ============================================================================
# Determines whether numeric attributes should be interpreted as binary or as
# bound number fields (ActualDBFrepresentation)
DEFAULT_MACRO SHAPEFILE_IN_NUMERIC_TYPE_ATTRIBUTE_HANDLING_SHAPEFILE_1 STANDARD_TYPES
SHAPEFILE_1_NUMERIC_TYPE_ATTRIBUTE_HANDLING "$(SHAPEFILE_IN_NUMERIC_TYPE_ATTRIBUTE_HANDLING_SHAPEFILE_1)"
#Note: Using the search envelope requires the shape index files (.sbnand.sbx)
DEFAULT_MACRO SHAPEFILE_IN_EXPOSE_ATTRS_GROUP_SHAPEFILE_1 
SHAPEFILE_1_EXPOSE_ATTRS_GROUP "$(SHAPEFILE_IN_EXPOSE_ATTRS_GROUP_SHAPEFILE_1)"
# Include this file in source setting section to add native search envelope processing
# Zero as a default means we don't do any search -- this makes workbench happier
DEFAULT_MACRO SHAPEFILE_IN_USE_SEARCH_ENVELOPE_SHAPEFILE_1 NO
SHAPEFILE_1_USE_SEARCH_ENVELOPE "$(SHAPEFILE_IN_USE_SEARCH_ENVELOPE_SHAPEFILE_1)"
GUI ACTIVEDISCLOSUREGROUP SHAPEFILE_IN_USE_SEARCH_ENVELOPE_SHAPEFILE_1 SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1%SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1%SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1%SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1%SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1%SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1%SHAPEFILE_IN_SEARCH_METHOD%SHAPEFILE_IN_SEARCH_METHOD_FILTER%SHAPEFILE_IN_SEARCH_ORDER%SHAPEFILE_IN_SEARCH_FEATURE%SHAPEFILE_IN_DUMMY_SEARCH_ENVELOPE_PARAMETER Use Search Envelope
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1 <Unused>,0 
DEFAULT_MACRO SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1 0
SHAPEFILE_1_SEARCH_ENVELOPE "$(SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1)"
GUI OPTIONAL FLOAT SHAPEFILE_IN_SEARCH_ENVELOPE_MINX_SHAPEFILE_1 Minimum X:
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1 <Unused>,0 
DEFAULT_MACRO SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1 0
SHAPEFILE_1_SEARCH_ENVELOPE "$(SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1)"
GUI OPTIONAL FLOAT SHAPEFILE_IN_SEARCH_ENVELOPE_MINY_SHAPEFILE_1 Minimum Y:
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1 <Unused>,0 
DEFAULT_MACRO SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1 0
SHAPEFILE_1_SEARCH_ENVELOPE "$(SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1)"
GUI OPTIONAL FLOAT SHAPEFILE_IN_SEARCH_ENVELOPE_MAXX_SHAPEFILE_1 Maximum X:
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1 <Unused>,0 
DEFAULT_MACRO SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1 0
SHAPEFILE_1_SEARCH_ENVELOPE "$(SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1)"
GUI OPTIONAL FLOAT SHAPEFILE_IN_SEARCH_ENVELOPE_MAXY_SHAPEFILE_1 Maximum Y:
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1 <Unused>, 
DEFAULT_MACRO SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1 
SHAPEFILE_1_SEARCH_ENVELOPE "$(SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1)"
GUI OPTIONAL COORDSYS SHAPEFILE_IN_SEARCH_ENVELOPE_COORDINATE_SYSTEM_SHAPEFILE_1 Search Envelope Coordinate System:
# ===========================================================================
GUI LOOKUP SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1 <Unused>,NO 
DEFAULT_MACRO SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1 NO
SHAPEFILE_1_CLIP_TO_ENVELOPE "$(SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1)"
GUI OPTIONAL CHECKBOX SHAPEFILE_IN_CLIP_TO_ENVELOPE_SHAPEFILE_1 YES%NO Clip to Search Envelope
DEFAULT_MACRO SHAPEFILE_IN_ADVANCED_SHAPEFILE_1 
GUI OPTIONAL DISCLOSUREGROUP SHAPEFILE_IN_ADVANCED_SHAPEFILE_1 SHAPEFILE_IN_TRIM_PRECEDING_SPACES_SHAPEFILE_1%SHAPEFILE_IN_READ_BLANK_AS_SHAPEFILE_1%SHAPEFILE_IN_DONUT_DETECTION_SHAPEFILE_1%SHAPEFILE_IN_MEASURES_AS_Z_SHAPEFILE_1%SHAPEFILE_IN_REPORT_BAD_GEOMETRY_SHAPEFILE_1 Advanced
DEFAULT_MACRO SHAPEFILE_IN_TRIM_PRECEDING_SPACES_SHAPEFILE_1 Yes
SHAPEFILE_1_TRIM_PRECEDING_SPACES "$(SHAPEFILE_IN_TRIM_PRECEDING_SPACES_SHAPEFILE_1)"
GUI CHOICE SHAPEFILE_IN_TRIM_PRECEDING_SPACES_SHAPEFILE_1 Yes%No Trim Preceding Spaces
DEFAULT_MACRO SHAPEFILE_IN_READ_BLANK_AS_SHAPEFILE_1 MISSING
SHAPEFILE_1_READ_BLANK_AS "$(SHAPEFILE_IN_READ_BLANK_AS_SHAPEFILE_1)"
GUI LOOKUP_CHOICE SHAPEFILE_IN_READ_BLANK_AS_SHAPEFILE_1 Missing,MISSING%Null,NULL Read Blank Fields as:
# ============================================================================
# Option to use simple donut geometry creation, which is faster than the
# original creation method, but less meticulous at detecting and correcting
# geometric anomalies (i.e.holeswithinholes)
DEFAULT_MACRO SHAPEFILE_IN_DONUT_DETECTION_SHAPEFILE_1 ORIENTATION
SHAPEFILE_1_DONUT_DETECTION "$(SHAPEFILE_IN_DONUT_DETECTION_SHAPEFILE_1)"
GUI LOOKUP_CHOICE SHAPEFILE_IN_DONUT_DETECTION_SHAPEFILE_1 "\"Orientation Only\",ORIENTATION"%"\"Orientation and Spatial Relationship\",SPATIAL" Donut Geometry Detection
# ============================================================================
# The following GUI line sets whether measure values in the shapefiles should
# be treated as elevations.
DEFAULT_MACRO SHAPEFILE_IN_MEASURES_AS_Z_SHAPEFILE_1 No
SHAPEFILE_1_MEASURES_AS_Z "$(SHAPEFILE_IN_MEASURES_AS_Z_SHAPEFILE_1)"
GUI CHOICE SHAPEFILE_IN_MEASURES_AS_Z_SHAPEFILE_1 Yes%No Treat Measures as Elevation
# ============================================================================
# The following keyword sets whether bad geometry should be reported via
# the shape_geometry_errors attribute.
DEFAULT_MACRO SHAPEFILE_IN_REPORT_BAD_GEOMETRY_SHAPEFILE_1 No
SHAPEFILE_1_REPORT_BAD_GEOMETRY "$(SHAPEFILE_IN_REPORT_BAD_GEOMETRY_SHAPEFILE_1)"
GUI CHOICE SHAPEFILE_IN_REPORT_BAD_GEOMETRY_SHAPEFILE_1 Yes%No Report Geometry Anomalies
# ===========================================================================
DEFAULT_MACRO SHAPEFILE_IN_NETWORK_AUTHENTICATION_SHAPEFILE_1 
SHAPEFILE_1_NETWORK_AUTHENTICATION "$(SHAPEFILE_IN_NETWORK_AUTHENTICATION_SHAPEFILE_1)"
GUI OPTIONAL AUTHENTICATOR SHAPEFILE_IN_NETWORK_AUTHENTICATION_SHAPEFILE_1 CONTAINER%GROUP%CONTAINER_TITLE%"Network Authentication"%PROMPT_TYPE%NETWORK Network Authentication
# ============================================================================ 
DEFAULT_MACRO SHAPEFILE_IN_ATTRIBUTE_READING_SHAPEFILE_1 ALL
SHAPEFILE_1_ATTRIBUTE_READING "$(SHAPEFILE_IN_ATTRIBUTE_READING_SHAPEFILE_1)"
# ============================================================================ 
SHAPEFILE_1_GENERATE_FME_BUILD_NUM 20806
SHAPEFILE_1_DATASET "$(SourceDataset_SHAPEFILE_1)"
MACRO WB_KEYWORD "CSV2_1"
# =====================================================================
# The following GUI line prompts for a folder where the
# CSV files will be stored
DEFAULT_MACRO DestDataset
INCLUDE [ if {"$(DestDataset)" != ""} {                          \
 puts {DEFAULT_MACRO DestDataset_CSV2_1 $(DestDataset)}         \
 } ]
DEFAULT_MACRO DestDataset_CSV2_1 $(DestDataset_CSV2)
GUI DIRNAME DestDataset_CSV2_1 Destination CSV (Comma Separated Value) Folder:
DEFAULT_MACRO CSV2_OUT_DATASET_GROUP_CSV2_1 
GUI OPTIONAL DISCLOSUREGROUP CSV2_OUT_DATASET_GROUP_CSV2_1 CSV2_OUT_EXTENSION_CSV2_1%CSV2_OUT_EXISTING_FILE_HANDLING Dataset
DEFAULT_MACRO CSV2_OUT_EXTENSION_CSV2_1 csv
CSV2_1_EXTENSION "$(CSV2_OUT_EXTENSION_CSV2_1)"
GUI OPTIONAL TEXT CSV2_OUT_EXTENSION_CSV2_1 Extension:
DEFAULT_MACRO CSV2_OUT_EXISTING_FILE_HANDLING_CSV2_1 Yes
CSV2_1_EXISTING_FILE_HANDLING "$(CSV2_OUT_EXISTING_FILE_HANDLING_CSV2_1)"
DEFAULT_MACRO CSV2_OUT_FIELDS_GROUP_CSV2_1 
GUI OPTIONAL DISCLOSUREGROUP CSV2_OUT_FIELDS_GROUP_CSV2_1 CSV2_OUT_DELIMITER_CSV2_1%CSV2_OUT_WRITE_FIELD_NAMES Fields
DEFAULT_MACRO CSV2_OUT_DELIMITER_CSV2_1 <comma>
CSV2_1_DELIMITER "$(CSV2_OUT_DELIMITER_CSV2_1)"
GUI STRING_OR_CHOICE_ENCODED CSV2_OUT_DELIMITER_CSV2_1 ,%;%|%space%tab Delimiter Character:
DEFAULT_MACRO CSV2_OUT_WRITE_FIELD_NAMES_CSV2_1 firstrow
CSV2_1_WRITE_FIELD_NAMES "$(CSV2_OUT_WRITE_FIELD_NAMES_CSV2_1)"
DEFAULT_MACRO CSV2_OUT_ENCODING_GROUP_CSV2_1 
GUI OPTIONAL DISCLOSUREGROUP CSV2_OUT_ENCODING_GROUP_CSV2_1 CSV2_OUT_ENCODING_CSV2_1%CSV2_OUT_WRITE_BOM_FOR_UNICODE_CSV2_1 Encoding
DEFAULT_MACRO CSV2_OUT_ENCODING_CSV2_1 UTF-8
CSV2_1_ENCODING "$(CSV2_OUT_ENCODING_CSV2_1)"
GUI STRING_OR_ENCODING CSV2_OUT_ENCODING_CSV2_1 fme-system%* Character Encoding:
DEFAULT_MACRO CSV2_OUT_WRITE_BOM_FOR_UNICODE_CSV2_1 Yes
CSV2_1_WRITE_BOM_FOR_UNICODE "$(CSV2_OUT_WRITE_BOM_FOR_UNICODE_CSV2_1)"
GUI CHOICE CSV2_OUT_WRITE_BOM_FOR_UNICODE_CSV2_1 Yes%No Write Byte Order Mark for Unicode:
DEFAULT_MACRO CSV2_OUT_ADVANCED_GROUP_CSV2_1 
GUI OPTIONAL DISCLOSUREGROUP CSV2_OUT_ADVANCED_GROUP_CSV2_1 FME_DISCLOSURE_CLOSED%CSV2_OUT_QUALIFY_FIELD_NAMES_CSV2_1%CSV2_OUT_QUALIFY_FIELD_VALUES_CSV2_1%CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1%CSV2_OUT_FIELD_QUALIFIER_CHARACTER_CSV2_1%CSV2_OUT_FIELD_QUALIFIER_ESCAPE_CHARACTER_CSV2_1%CSV2_OUT_ROW_TERMINATION_CSV2_1%CSV2_OUT_WRITE_SCHEMA_FILE_CSV2_1 Advanced
DEFAULT_MACRO CSV2_OUT_QUALIFY_FIELD_NAMES_CSV2_1 if_needed
CSV2_1_QUALIFY_FIELD_NAMES "$(CSV2_OUT_QUALIFY_FIELD_NAMES_CSV2_1)"
GUI LOOKUP_CHOICE CSV2_OUT_QUALIFY_FIELD_NAMES_CSV2_1 Yes,yes%No,no%If<space>Needed,if_needed Qualify Field Names:
DEFAULT_MACRO CSV2_OUT_QUALIFY_FIELD_VALUES_CSV2_1 if_needed
CSV2_1_QUALIFY_FIELD_VALUES "$(CSV2_OUT_QUALIFY_FIELD_VALUES_CSV2_1)"
GUI ACTIVECHOICE_LOOKUP CSV2_OUT_QUALIFY_FIELD_VALUES_CSV2_1 Yes,yes,CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1%No,no%If<space>Needed,if_needed,CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1 Qualify Field Values:
DEFAULT_MACRO CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1 <Unused>
CSV2_1_UNQUALIFIED_FIELD_VALUE_HANDLING "$(CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1)"
GUI LOOKUP_CHOICE CSV2_OUT_UNQUALIFIED_FIELD_VALUE_HANDLING_CSV2_1 Remove<space>Unsafe<space>Characters,remove_unsafe%Preserve<space>Unsafe<space>Characters,preserve_unsafe Unqualified Field Value Handling:
DEFAULT_MACRO CSV2_OUT_FIELD_QUALIFIER_CHARACTER_CSV2_1 <quote>
CSV2_1_FIELD_QUALIFIER_CHARACTER "$(CSV2_OUT_FIELD_QUALIFIER_CHARACTER_CSV2_1)"
GUI STRING_ENCODED CSV2_OUT_FIELD_QUALIFIER_CHARACTER_CSV2_1 Field Qualifier Character:
DEFAULT_MACRO CSV2_OUT_FIELD_QUALIFIER_ESCAPE_CHARACTER_CSV2_1 <quote>
CSV2_1_FIELD_QUALIFIER_ESCAPE_CHARACTER "$(CSV2_OUT_FIELD_QUALIFIER_ESCAPE_CHARACTER_CSV2_1)"
GUI STRING_ENCODED CSV2_OUT_FIELD_QUALIFIER_ESCAPE_CHARACTER_CSV2_1 Field Qualifier Escape Character:
DEFAULT_MACRO CSV2_OUT_ROW_TERMINATION_CSV2_1 System
CSV2_1_ROW_TERMINATION "$(CSV2_OUT_ROW_TERMINATION_CSV2_1)"
GUI CHOICE CSV2_OUT_ROW_TERMINATION_CSV2_1 System%Windows%Unix%Macintosh Row Termination:
DEFAULT_MACRO CSV2_OUT_WRITE_SCHEMA_FILE_CSV2_1 NO
CSV2_1_WRITE_SCHEMA_FILE "$(CSV2_OUT_WRITE_SCHEMA_FILE_CSV2_1)"
GUI ACTIVEDISCLOSUREGROUP CSV2_OUT_WRITE_SCHEMA_FILE_CSV2_1 FME_DISCLOSURE_CLOSED%CSV2_OUT_EXISTING_SCHEMA_FILE_HANDLING_CSV2_1 Write Schema Configuration File
DEFAULT_MACRO CSV2_OUT_EXISTING_SCHEMA_FILE_HANDLING_CSV2_1 <Unused>
CSV2_1_EXISTING_SCHEMA_FILE_HANDLING "$(CSV2_OUT_EXISTING_SCHEMA_FILE_HANDLING_CSV2_1)"
GUI CHOICE CSV2_OUT_EXISTING_SCHEMA_FILE_HANDLING_CSV2_1 Overwrite%Prepend Existing Schema File Handling:
DEFAULT_MACRO CSV2_OUT_COORDINATE_SYSTEM_GRANULARITY_CSV2_1 FEATURE_TYPE
CSV2_1_COORDINATE_SYSTEM_GRANULARITY "$(CSV2_OUT_COORDINATE_SYSTEM_GRANULARITY_CSV2_1)"
# ============================================================================ 
CSV2_1_GENERATE_FME_BUILD_NUM 20806
CSV2_1_DATASET "$(DestDataset_CSV2_1)"
MACRO WB_KEYWORD "TIFF_1"
# The following GUI lines prompt for a TIFF file to be used as the
# the destination of the data.
# The user input is stored in a macro, which is then used to define
# the dataset to be written.
DEFAULT_MACRO DestDataset
INCLUDE [ if {"$(DestDataset)" != ""} {                          \
 puts {DEFAULT_MACRO DestDataset_TIFF_1 $(DestDataset)}         \
 } ]
DEFAULT_MACRO DestDataset_TIFF_1 $(DestDataset_TIFF)
GUI DIRNAME DestDataset_TIFF_1 Destination TIFF (Tagged Image File Format) Folder:
DEFAULT_MACRO _TIFF_WRITER_WORLD_FILE_GENERATION_TIFF_1 yes
DEFAULT_MACRO _TIFF_WRITER_CREATE_TILED_FILES_TIFF_1 no
DEFAULT_MACRO _TIFF_WRITER_TILE_SIZE_X_TIFF_1
DEFAULT_MACRO _TIFF_WRITER_TILE_SIZE_Y_TIFF_1
DEFAULT_MACRO _TIFF_WRITER_COMPRESSION_METHOD_TIFF_1 none
DEFAULT_MACRO _TIFF_WRITER_JPEG_COMPRESSION_LEVEL_TIFF_1 25
DEFAULT_MACRO _TIFF_WRITER_TAB_FILE_GENERATION_TIFF_1 no
DEFAULT_MACRO _TIFF_WRITER_NUMBER_OF_BITS_PER_CELL_TIFF_1
DEFAULT_MACRO _TIFF_WRITER_ENABLE_BIGTIFF_TIFF_1 no
DEFAULT_MACRO _TIFF_WRITER_INTERLEAVING_TYPE_TIFF_1 BIP
DEFAULT_MACRO _TIFF_WRITER_PHOTOMETRIC_INTERPRETATION_TIFF_1 Auto
DEFAULT_MACRO _TIFF_WRITER_BYTE_ORDER_TIFF_1 machine
DEFAULT_MACRO _TIFF_WRITER_CALCULATE_MINMAX_TIFFTAGS_TIFF_1 no
DEFAULT_MACRO _TIFF_WRITER_GENERATE_PYRAMIDS_TIFF_1 no
DEFAULT_MACRO _TIFF_WRITER_PYRAMID_NUM_LEVELS_TIFF_1
DEFAULT_MACRO _TIFF_WRITER_PYRAMID_INTERPOLATION_TYPE_TIFF_1 NearestNeighbor
DEFAULT_MACRO _TIFF_WRITER_PYRAMID_TILE_SIZE_TIFF_1 128
DEFAULT_MACRO TIFF_OUT_COORDINATE_SYSTEM_GRANULARITY_TIFF_1 FEATURE
TIFF_1_COORDINATE_SYSTEM_GRANULARITY "$(TIFF_OUT_COORDINATE_SYSTEM_GRANULARITY_TIFF_1)"
# ============================================================================ 
TIFF_1_GENERATE_FME_BUILD_NUM 20806
TIFF_1_DATASET "$(DestDataset_TIFF_1)"
LOG_FILENAME "$(FME_MF_DIR)bledycw2.log"
LOG_APPEND NO
LOG_FILTER_MASK -1
LOG_MAX_FEATURES 200
LOG_MAX_RECORDED_FEATURES 200
FME_REPROJECTION_ENGINE FME
FME_IMPLICIT_CSMAP_REPROJECTION_MODE Auto
FME_GEOMETRY_HANDLING Enhanced
FME_STROKE_MAX_DEVIATION 0
DEFAULT_MACRO DATASET_KEYWORD_SHAPEFILE_1 SHAPEFILE_1
DEFAULT_MACRO DATASET_KEYWORD_CSV2_1 CSV2_1
DEFAULT_MACRO DATASET_KEYWORD_TIFF_1 TIFF_1
FME_PASSWORD_PARAMETER_LIST haslo
# -------------------------------------------------------------------------

SHAPEFILE_1_READER_META_ATTRIBUTES fme_feature_type

# -------------------------------------------------------------------------

MULTI_READER_CONTINUE_ON_READER_FAILURE No
FME_BEGIN_PYTHON_ENC import<space>fme<lf>from<space>fmeobjects<space>import<space>*<lf>import<space>smtplib<space><lf>from<space>email.message<space>import<space>EmailMessage<space><lf>from<space>datetime<space>import<space>datetime<lf><lf>global<space>email<lf>email<space>=<space>fme.macroValues<openbracket><apos>email_host<apos><closebracket><lf>global<space>password<lf>password<space>=<space>fme.macroValues<openbracket><apos>haslo<apos><closebracket><lf>global<space>email_client<lf>email_client<space>=<space>fme.macroValues<openbracket><apos>email_klient<apos><closebracket><lf>global<space>county<lf>county<space>=<space>fme.macroValues<openbracket><apos>powiat<apos><closebracket><space><lf>global<space>now<lf>now<space>=<space>datetime.now<openparen><closeparen><lf>date<space>=<space>now.strftime<openparen><quote>%d<solidus>%m<solidus>%Y<space>%H:%M:%S<quote><closeparen><lf><lf>message<space>=<space>EmailMessage<openparen><closeparen><lf>message<openbracket><apos>Subject<apos><closebracket><space>=<space><apos>Dane<space>z<space>misji<space>ESA<space>Sentinel<space>2<space>dla<space>powiatu:<space><apos><space>+<space>county<space><lf>message<openbracket><apos>From<apos><closebracket><space>=<space>email<lf>message<openbracket><apos>To<apos><closebracket><space>=<space>email_client<lf><lf>message.set_content<openparen><apos>Drogi<space>u<u017c>ytkowniku<space><apos>+<space>email<space>+<space><apos><space><comma><space>wraz<space>z<space>dat<u0105><space><apos><space>+<space>date<space>+<space><apos><space>rozpocz<u0119>to<space>przetwarzanie<space>danych<space>dla<space>powiatu<space><apos>+<space>county<closeparen><lf>with<space>smtplib.SMTP_SSL<openparen><apos>smtp.gmail.com<apos><comma><space>465<closeparen><space>as<space>smtp:<lf><space><space><space><space>smtp.login<openparen>email<comma><space>password<closeparen><lf><space><space><space><space>smtp.send_message<openparen>message<closeparen><lf><space><space><space><space><lf>global<space>fmeErrors<lf>fmeErrors<space>=<openbracket><closebracket><lf><lf>def<space>ErrorsAppend<openparen>severity<comma>text<closeparen>:<lf><space><space><space><space>if<space>severity<space>in<openparen><space>FME_ERROR<comma><space>FME_FATAL<comma>FME_WARN<closeparen>:<lf><space><space><space><space><space><space><space><space>fmeErrors.append<openparen>text<closeparen><lf><space><space><space><space><space><space><space><space><lf>FMELogFile<openparen><closeparen>.setCallBack<openparen>ErrorsAppend<closeparen>
FME_END_PYTHON_ENC import<space>fme<lf>from<space>fmeobjects<space>import<space>*<lf>import<space>json<lf>import<space>smtplib<space><lf>from<space>email.message<space>import<space>EmailMessage<space><lf>from<space>datetime<space>import<space>datetime<lf><lf><lf>start<space>=<space>fme.macroValues<openbracket><apos>data_poczatkowa<apos><closebracket><lf>end<space>=<space>fme.macroValues<openbracket><apos>data_koncowa<apos><closebracket><lf>clouds=<space>fme.macroValues<openbracket><apos>pokrycie_chmurami<apos><closebracket><lf><lf>now_2<space>=<space>datetime.now<openparen><closeparen><lf>exec_time<space>=<space>now_2<space>-<space>now<lf><lf>message<space>=<space>EmailMessage<openparen><closeparen><lf>message<openbracket><apos>Subject<apos><closebracket><space>=<space><apos>Proces<space>zako<u0144>czony<apos><space><lf>message<openbracket><apos>From<apos><closebracket><space>=<space>email<lf>message<openbracket><apos>To<apos><closebracket><space>=<space>email_client<lf><lf><lf>if<space>fme.status==0:<lf><space><space><space><space>message.set_content<openparen><apos>Proces<space>zosta<u0142><space>przerwany<space>ze<space>wzgl<u0119>du<space>na<space>brak<space>odpowiednich<space>zobrazowa<u0144><space>satelitarnych<space>spe<u0142>niaj<u0105>cych<space>kryteria:<space>powiat<space><apos><space>+<space>county<space>+<space><apos><comma><space>pokrycie<space>chmurami<space><space><apos>+<lf><space><space><space><space>clouds+<apos><comma><space>data<space>pocz<u0105>tkowa<space><apos>+<space>start<space>+<space><apos><comma><space>data<space>ko<u0144>cowa<space><apos>+<space>end<closeparen><lf><space><space><space><space><lf><space><space><space><space>with<space>open<openparen><quote>E:<backslash>Studia<backslash>Bazy_danych_przestrzennych<backslash>FME_2<backslash>log.json<quote><comma><apos>w<apos><closeparen><space>as<space>log:<lf><space><space><space><space><space><space><space><space>json.dump<openparen>fmeErrors<comma>log<closeparen><lf><space><space><space><space><space><space><space><lf><space><space><space><space>with<space>open<openparen><quote>E:<backslash>Studia<backslash>Bazy_danych_przestrzennych<backslash>FME_2<backslash>log.json<quote><comma><apos>rb<apos><closeparen><space>as<space>file:<lf><space><space><space><space><space><space><space><space>file_data<space>=<space>file.read<openparen><closeparen><lf><space><space><space><space><space><space><space><space>file_name<space>=<space><quote>logs.json<quote><lf><lf><space><space><space><space>message.add_attachment<openparen>file_data<comma><space>maintype=<apos>application<apos><comma><space>subtype=<apos>json<apos><comma><space>filename=file_name<closeparen><lf><space><space><space><space><lf>else:<lf><space><space><space><space>message.set_content<openparen><apos>Czas<space>trwania:<apos><space>+<space>str<openparen>exec_time<closeparen><closeparen><lf><space><space><space><space>with<space>open<openparen><quote>E:<backslash>Studia<backslash>Bazy_danych_przestrzennych<backslash>FME_2<backslash>statystyki.csv<quote><comma><apos>rb<apos><closeparen><space>as<space>file2:<lf><space><space><space><space><space><space><space><space>file2_data<space>=<space>file2.read<openparen><closeparen><lf><space><space><space><space><space><space><space><space>file2_name<space>=<space><quote>statystki.csv<quote><lf><lf><space><space><space><space>message.add_attachment<openparen>file2_data<comma><space>maintype=<apos>application<apos><comma><space>subtype=<apos>csv<apos><comma><space>filename=file2_name<closeparen><lf><lf><space><space><space><space>with<space>open<openparen><quote>E:<backslash>Studia<backslash>Bazy_danych_przestrzennych<backslash>FME_2<backslash>tiff.tif<quote><comma><apos>rb<apos><closeparen><space>as<space>file3:<lf><space><space><space><space><space><space><space><space>file3_data<space>=<space>file3.read<openparen><closeparen><lf><space><space><space><space><space><space><space><space>file3_name<space>=<space><quote>tiff.tif<quote><lf><lf><space><space><space><space>message.add_attachment<openparen>file3_data<comma><space>maintype=<apos>image<apos><comma><space>subtype=<apos>tif<apos><comma><space>filename=file3_name<closeparen><lf><lf><lf><lf>with<space>smtplib.SMTP_SSL<openparen><apos>smtp.gmail.com<apos><comma><space>465<closeparen><space>as<space>smtp:<lf><space><space><space><space>smtp.login<openparen>email<comma><space>password<closeparen><lf><space><space><space><space>smtp.send_message<openparen>message<closeparen>

# -------------------------------------------------------------------------

MACRO WORKSPACE_NAME Sentinel

MACRO FME_VIEWER_APP fmedatainspector

# -------------------------------------------------------------------------
SHAPEFILE_1_DEF Powiaty                                                \
  shapefile_type               shapefile_polygon                       \
  JPT_SJR_KO                   char(3)                                 \
  JPT_KOD_JE                   char(20)                                \
  JPT_NAZWA_                   char(128)                               \
  JPT_ORGAN_                   char(254)                               \
  JPT_JOR_ID                   long                                    \
  WERSJA_OD                    date                                    \
  WERSJA_DO                    date                                    \
  WAZNY_OD                     date                                    \
  WAZNY_DO                     date                                    \
  JPT_KOD__1                   char(3)                                 \
  JPT_NAZWA1                   char(3)                                 \
  JPT_ORGAN1                   char(3)                                 \
  JPT_WAZNA_                   char(3)                                 \
  ID_BUFORA_                   double                                  \
  ID_BUFORA1                   double                                  \
  ID_TECHNIC                   long                                    \
  IIP_PRZEST                   char(20)                                \
  IIP_IDENTY                   char(128)                               \
  IIP_WERSJA                   char(32)                                \
  JPT_KJ_IIP                   char(20)                                \
  JPT_KJ_I_1                   char(128)                               \
  JPT_KJ_I_2                   char(32)                                \
  JPT_OPIS                     char(254)                               \
  JPT_SPS_KO                   char(3)                                 \
  ID_BUFOR_1                   long                                    \
  JPT_ID                       long                                    \
  JPT_KJ_I_3                   char(3)                                 \
  Shape_Leng                   double                                  \
  Shape_Area                   double

# -------------------------------------------------------------------------

FACTORY_DEF * RoutingFactory                                           \
  FACTORY_NAME "Router and Unexpected Input Remover"                   \
  COMMAND_PARM_EVALUATION SINGLE_PASS                                  \
  MULTI_READER_KEYWORD $(DATASET_KEYWORD_SHAPEFILE_1)                  \
  INPUT FEATURE_TYPE *                                                 \
   ROUTE SHAPEFILE SHAPEFILE_1::Powiaty multi_reader_keyword,$(DATASET_KEYWORD_SHAPEFILE_1) TO FME_GENERIC ::Powiaty ALIAS_GEOMETRY \
   MERGE_INPUT Yes                                                     \
  OUTPUT ROUTED FEATURE_TYPE *

SHAPEFILE_1_MERGE_DEF SHAPEFILE_1::Powiaty EXACT Powiaty

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME "Powiaty_SHAPEFILE_1 Splitter"                         \
   INPUT FEATURE_TYPE Powiaty                                          \
   OUTPUT FEATURE_TYPE Powiaty_SHAPEFILE_1

DEFAULT_MACRO WB_CURRENT_CONTEXT

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME Tester                                                 \
   INPUT  FEATURE_TYPE Powiaty_SHAPEFILE_1                             \
   CASE_SENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>JPT_NAZWA_<closeparen>,Tester)" CONTAINS_REGEX "@EvaluateExpression(FDIV,STRING_ENCODED,$(powiat$encode),Tester)" ENCODED \
   BOOLEAN_OPERATOR OR                                                 \
   COMPOSITE_TEST_EXPR "1"                                             \
   FEATURE_TABLE_SHIM_SUPPORT Yes                                      \
   PRESERVE_FEATURE_ORDER PER_OUTPUT_PORT                              \
   OUTPUT PASSED FEATURE_TYPE Tester_PASSED

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "Tester PASSED Splitter"                                \
  INPUT FEATURE_TYPE Tester_PASSED                                     \
  OUTPUT FEATURE_TYPE Tester_PASSED_0_M1wqjkih4e0=                     \
  OUTPUT FEATURE_TYPE Tester_PASSED_1_8t6d0F2OYOU=

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Initiator Input Collector"          \
  INPUT FEATURE_TYPE Tester_PASSED_0_M1wqjkih4e0=                      \
  OUTPUT FEATURE_TYPE SentinelDownloader_Initiator

MACRO SentinelDownloader_WORKSPACE_NAME SentinelDownloader

MACRO $(SentinelDownloader_WORKSPACE_NAME)_XFORMER_NAME SentinelDownloader

MACRO $(SentinelDownloader_WORKSPACE_NAME)_TRANSFORMER_GROUP 

MACRO $(SentinelDownloader_WORKSPACE_NAME)___COMPOUND_PARAMETERS 

MACRO $(SentinelDownloader_WORKSPACE_NAME)_SUB_DOC_NAME SentinelDownloader

MACRO $(SentinelDownloader_WORKSPACE_NAME)_key_name placeholder

MACRO $(SentinelDownloader_WORKSPACE_NAME)_key_pw fme_decrypt(MDowfCN8I3xcG3GQ/TeRRUJUZ5LDPtdvpscbh7Nj9gG/INBkAGA+fkaDrNbhZtfa3rmkUUrCxKWaAFwiYsKgWJNl/0mRpxUuP+IT2c+Qhh26JEZtUWAmpuoaQCdQ3ykKWm2zaoAM5MBCGaGEuYe+6AS07/nLNRJwqp1jdwP1FgVCbXRvZtWfKjEZlNJYQ+EicVc6cv2DxCYJyTljvXwF8mKxenML6FKJiHARQCO8OMJidKKZQJP1SeYIhqB0YrtGw4cGV2ZquQKifvRjB2Tl6wBAWDmeCg+R1jvft1tR17SISyTDv77K+mV80w2aaUSgybbF7coM0BrQPcpehfjlW+YxV73+9mPMFXKQeznZ22T8MJor57O44p8U2NQCw35HiFBs0oVP9VkkY0D/WzGRevseyX1pIEWJSQSFwkJVhiyXavMDz5E5SEYgTZHfVeGBXCDuIEEbfRRkPU5yD2nw2ZAVimDRD7UQhEEY6PosGqU17He4y35WEfAggQ40+EKuupOQSZRsKotTTqlYGHJtX49ymuKqfyZzOAUSUzDMcj8gfDgzOCcuhw2sK3fJaMsz/3RPd+lihEYdGgno92SqoOq4qNN6UrlklLhepenTpw+KidQsQQp9teTjNuK6gplFcB3EzdBetzuTW53VXt4T/m+Tti8zVwWJKcH4qVQEVAlzQO+qJ2knWg5ZRFok76BaFTOqrb+D6DKi9TkgeB+OvivducHB/njnZeOKEcZY1MCQIMgenYnPP738RcLxAVQTi8FxkztuWA3WrWahzGpInhzM4d8r0s6jzDawQPGHjeOZxy6Tu63g2a/XO5NEpRA6cD2p7hH2ZIR1jyvO338DBOAvhsSsW/V8GrdE1KE4JUCsFFgNcrUglR/I5t5LFWbtBFH+EjVEVsZSkuBMskskIARLbmvvaLny)

MACRO $(SentinelDownloader_WORKSPACE_NAME)_BEGIN $(data_poczatkowa)

MACRO $(SentinelDownloader_WORKSPACE_NAME)_END $(data_koncowa)

MACRO $(SentinelDownloader_WORKSPACE_NAME)_LEVEL Level 2A

MACRO $(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution All

MACRO $(SentinelDownloader_WORKSPACE_NAME)_CloudCover $(pokrycie_chmurami)

MACRO $(SentinelDownloader_WORKSPACE_NAME)_zip_output $(FME_MF_DIR)pobrane.zip

MACRO $(SentinelDownloader_WORKSPACE_NAME)_platform Sentinel-2

DEFAULT_MACRO SentinelDownloader_WORKSPACE_NAME ""

INCLUDE [puts {MACRO WB_OLD_CONTEXT_$(SentinelDownloader_WORKSPACE_NAME) $(WB_CURRENT_CONTEXT)}; \
         puts {MACRO WB_CURRENT_CONTEXT $(SentinelDownloader_WORKSPACE_NAME)}]

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Initiator1610612239 Input Splitter" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Initiator"  \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Initiator"

# -------------------------------------------------------------------------

FACTORY_DEF * TextEncoderFactory                                       \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TextEncoder       \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Initiator" \
   ACTION BASE64_ENCODE                                                \
   RESULT_ATTR "_key_encoded"                                          \
   VALUE_TO_ENCODE "@EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_key_name$encode):$($(SentinelDownloader_WORKSPACE_NAME)_key_pw$encode),$(SentinelDownloader_WORKSPACE_NAME)_TextEncoder)" \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TextEncoder_OUTPUT"

# -------------------------------------------------------------------------

DEFAULT_MACRO WB_CURRENT_CONTEXT

MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_VAR key

INCLUDE [                                                              \
   if {{Global} == {Local}} {                                          \
      puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_VAR $(WB_CURRENT_CONTEXT)_key}; \
   };                                                                  \
   proc stripEvaluateExpression {val} {                                \
      if [regexp {@EvaluateExpression\([^)]*STRING_ENCODED,([^,]*),.+\)} $val -> unwrapped] { \
         return $unwrapped                                             \
      } else {                                                         \
         return $val                                                   \
      };                                                               \
   };                                                                  \
   set strippedValue [stripEvaluateExpression {@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>_key_encoded<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_VariableSetter)}]; \
   puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_VALUE $strippedValue"; \
]

FACTORY_DEF {*} AttrSetFactory                                         \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_VariableSetter    \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TextEncoder_OUTPUT" \
   ATTR_ACTION { "" $(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_fa88ade2_17a3_45de_846e_eb4da195ea4c0 SET_TO "$($(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_VALUE)" } \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_OUTPUT" \
       @GlobalVariable($($(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_VAR),fme_attribute_name,$(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_fa88ade2_17a3_45de_846e_eb4da195ea4c0) \
       @RemoveAttributes($(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_fa88ade2_17a3_45de_846e_eb4da195ea4c0)

# -------------------------------------------------------------------------

MACRO OUTPUT_POINT_FTYPE not_selected

MACRO OUTPUT_POINT_FTYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_POINT

MACRO OUTPUT_AREA_FTYPE not_selected

MACRO OUTPUT_AREA_FTYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_AREA

MACRO OUTPUT_TEXT_FTYPE not_selected

MACRO OUTPUT_TEXT_FTYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_TEXT

MACRO OUTPUT_INSTANCE_FTYPE not_selected

Lookup $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_RouterTable \
  ""  "not_selected"                                                   \
  fme_point $(OUTPUT_POINT_FTYPE)                                      \
  fme_area $(OUTPUT_AREA_FTYPE)                                        \
  fme_text $(OUTPUT_TEXT_FTYPE)

MACRO COLLECTION_HANDLING NOT_THIS_TIME

MACRO INSTANCE_FILTERING *

INCLUDE [                                                              \
   if 0 {                                                              \
      puts "MACRO COLLECTION_HANDLING *";                              \
      if <Unused> {                                                    \
         puts "MACRO INSTANCE_FILTERING NOT_THIS_TIME";                \
      };                                                               \
   };                                                                  \
   if {{$(OUTPUT_INSTANCE_FTYPE)} == "not_selected"} {                 \
      puts "MACRO INSTANCE_FILTERING NOT_THIS_TIME";                   \
   };                                                                  \
]

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_InputPassThrough \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableSetter_OUTPUT" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Input___ \
      @Geometry(FIX_FMETYPE_FMEGEOMETRY)

FACTORY_DEF $(INSTANCE_FILTERING) TestFactory                          \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_InstanceTest \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Input___ \
   TEST @Geometry(IS_GEOMETRY_INSTANCE) == 1                           \
   OUTPUT PASSED FEATURE_TYPE $(OUTPUT_INSTANCE_FTYPE)                 \
   OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Input___

FACTORY_DEF $(COLLECTION_HANDLING) TestFactory                         \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_CollectionTest \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Input___ \
   TEST &fme_type == "fme_collection"                                  \
   OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Not_Collection___ \
   OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Collection___

FACTORY_DEF $(COLLECTION_HANDLING) DeaggregateFactory                  \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_Deagg \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Collection___ \
   HOMOGENIZE_COLLECTIONS YES                                          \
   RECURSIVE YES                                                       \
   SET_FME_TYPE YES                                                    \
   INSTANTIATE_GEOMETRY_INSTANCES_NEW <Unused>                         \
   OUTPUT POINT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___ \
   OUTPUT LINE FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___ \
   OUTPUT POLYGON FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___ \
   OUTPUT DONUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___ \
   OUTPUT AGGREGATE FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_RouterPrepper \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___HomogeneousAggregate___ \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Not_Collection___ \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Input___ \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Prepped___ \
       $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_11d93cd1_3d2b_4f3b_80ad_dda12e0f965f0_targetFeatureType @Lookup($(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_RouterTable,&fme_type)

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_Router \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter___Prepped___ \
   TEST @Value($(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_11d93cd1_3d2b_4f3b_80ad_dda12e0f965f0_targetFeatureType) != "not_selected" \
   OUTPUT PASSED FEATURE_TYPE * @FeatureType(@Value($(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_11d93cd1_3d2b_4f3b_80ad_dda12e0f965f0_targetFeatureType)) \
                                @RemoveAttributes($(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_11d93cd1_3d2b_4f3b_80ad_dda12e0f965f0_targetFeatureType) \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_<UNFILTERED>" \
       @RemoveAttributes($(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_11d93cd1_3d2b_4f3b_80ad_dda12e0f965f0_targetFeatureType)

# -------------------------------------------------------------------------

# The default behaviour is to abort on any feature entering the transformer.

# If Workbench has set the _WB_BYPASS_TERMINATION macro to a value of "Yes",

# then the features will instead be passed through with a feature type of

# __WB_BYPASS_TERMINATOR__, which Workbench will send to a visualizer or

# somesuch.

DEFAULT_MACRO _WB_BYPASS_TERMINATION No

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Terminator        \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_<UNFILTERED>" \
   TEST "$(_WB_BYPASS_TERMINATION)" == Yes                             \
   OUTPUT PASSED FEATURE_TYPE __WB_BYPASS_TERMINATOR__                 \
      @SupplyAttributes(_wb_termination_feature_type,@FeatureType())   \
      @SupplyAttributes(ENCODED,_wb_termination_message,"Translation<space>Terminated<space>because<space>none<space>of<space>the<space>input<space>parameters<space>was<space>either<space>a<space>point<comma><space>polygon<comma><space>or<space>text<space><openparen>WKT<closeparen><space>feature.") \
      @SupplyAttributes(_wb_termination_xformer,"$(SentinelDownloader_WORKSPACE_NAME)_Terminator") \
      @SupplyAttributes(_wb_termination_feature,Yes)                   \
   OUTPUT FAILED FEATURE_TYPE * @Abort(ENCODED,"Translation<space>Terminated<space>because<space>none<space>of<space>the<space>input<space>parameters<space>was<space>either<space>a<space>point<comma><space>polygon<comma><space>or<space>text<space><openparen>WKT<closeparen><space>feature.")

# -------------------------------------------------------------------------

FACTORY_DEF {*} AttrSetFactory                                         \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_3 \
   COMMAND_PARM_EVALUATION SINGLE_PASS                                 \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_TEXT" \
   MULTI_FEATURE_MODE NO                                               \
   NULL_ATTR_MODE NO_OP                                                \
    ATTRSET_CREATE_DIRECTIVES _PROPAGATE_MISSING_FDIV                  \
    ATTR_ACTION { "" "date_param" "SET_TO" "ingestionDate:<openbracket><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_BEGIN$encode)<comma>%Y-%m-%d<closeparen>T00:00:00.000Z<space>TO<space><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_END$encode)<comma>%Y-%m-%d<closeparen>T23:59:00.000Z<closebracket>" }  \
    ATTR_ACTION { "" "wkt_object" "SET_TO" "<at>Value<openparen>fme_text_string<closeparen>" }  \
    ATTR_ACTION { "" "product_type" "SET_TO" "FME_CONDITIONAL:DEFAULT_VALUE'producttype:S2MSI2A'BOOL_OP;OR;COMPOSITE_TEST;<Unused>;TEST $($(SentinelDownloader_WORKSPACE_NAME)_LEVEL$encode) = Level<space>1C'producttype:S2MSI1C'FME_NUM_CONDITIONS2___" } \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_3_OUTPUT"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter        \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_3_OUTPUT" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_0

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Condition_1 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_0 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>wkt_object<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter) CONTAINS POINT ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Point \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_1

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Condition_2 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_1 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>wkt_object<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter) CONTAINS POLYGON ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Polygon \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_2

FACTORY_DEF * TeeFactory                                               \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_<lt>UNFILTERED<gt> \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_TESTFILTERINPUTLINE_2 \
OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_<lt>UNFILTERED<gt>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter <lt>UNFILTERED<gt> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_<lt>UNFILTERED<gt>"

# -------------------------------------------------------------------------

MACRO casemac

INCLUDE [ if { {NO} == {NO} } { puts {MACRO casemac -nocase}} ]

Tcl2 proc $(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_294eab36_fae2_4e1f_b220_be967b4b8d140_replacer { findText replaceText invalidValue} { \
    set attrs [split \"wkt_object\" {,}];                              \
    set findValue [FME_DecodeText $findText];                          \
    set replaceValue [FME_DecodeText $replaceText];                    \
    foreach attr $attrs {                                              \
      set attrVal [FME_GetAttribute $attr];                            \
      set noMatch true;                                                \
      if {{NO} == {YES}} {                                             \
        set newAttrVal [FME_ReplaceRegex $(casemac) $findValue $attrVal $replaceValue]; \
      } else {                                                         \
        set newAttrVal [string map $(casemac) [list $findValue $replaceValue] $attrVal]; \
      };                                                               \
      if { $newAttrVal ne $attrVal } {                                 \
        set noMatch false;                                             \
        FME_SetAttribute $attr $newAttrVal;                            \
      };                                                               \
      if {$noMatch} {                                                  \
         if { $invalidValue == {FME_NULL_VALUE} } {                    \
            FME_SetAttributeNull $attr;                                \
         } elseif { $invalidValue != {_FME_NO_OP_} }  {                \
            FME_SetAttribute $attr [FME_DecodeText $invalidValue];     \
         };                                                            \
      };                                                               \
    };                                                                 \
}

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StringReplacer    \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Point" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_OUTPUT" \
        @Tcl2("$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_294eab36_fae2_4e1f_b220_be967b4b8d140_replacer {POINT<openparen>} {} {_FME_NO_OP_}")

# -------------------------------------------------------------------------

MACRO casemac

INCLUDE [ if { {NO} == {NO} } { puts {MACRO casemac -nocase}} ]

Tcl2 proc $(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_2_4d512776_74cd_463f_b2b4_1264cf8014b40_replacer { findText replaceText invalidValue} { \
    set attrs [split \"wkt_object\" {,}];                              \
    set findValue [FME_DecodeText $findText];                          \
    set replaceValue [FME_DecodeText $replaceText];                    \
    foreach attr $attrs {                                              \
      set attrVal [FME_GetAttribute $attr];                            \
      set noMatch true;                                                \
      if {{NO} == {YES}} {                                             \
        set newAttrVal [FME_ReplaceRegex $(casemac) $findValue $attrVal $replaceValue]; \
      } else {                                                         \
        set newAttrVal [string map $(casemac) [list $findValue $replaceValue] $attrVal]; \
      };                                                               \
      if { $newAttrVal ne $attrVal } {                                 \
        set noMatch false;                                             \
        FME_SetAttribute $attr $newAttrVal;                            \
      };                                                               \
      if {$noMatch} {                                                  \
         if { $invalidValue == {FME_NULL_VALUE} } {                    \
            FME_SetAttributeNull $attr;                                \
         } elseif { $invalidValue != {_FME_NO_OP_} }  {                \
            FME_SetAttribute $attr [FME_DecodeText $invalidValue];     \
         };                                                            \
      };                                                               \
    };                                                                 \
}

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_2  \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_OUTPUT" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_2_OUTPUT" \
        @Tcl2("$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_2_4d512776_74cd_463f_b2b4_1264cf8014b40_replacer {<closeparen>} {} {_FME_NO_OP_}")

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5      \
      INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StringReplacer_2_OUTPUT" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_Polygon" \
   TARGET_URL "@EvaluateExpression(FDIV,STRING_ENCODED,https:<solidus><solidus>scihub.copernicus.eu<solidus>dhus<solidus>search?q=<openparen>footprint:<quote>Intersects<openparen><at>Value<openparen>wkt_object<closeparen><closeparen><quote><space>AND<space>platformname:$($(SentinelDownloader_WORKSPACE_NAME)_platform$encode)<space><space>AND<space><at>Value<openparen>product_type<closeparen><space>AND<space><at>Value<openparen>date_param<closeparen><space>AND<space>cloudcoverpercentage:<openbracket>0<space>TO<space>$($(SentinelDownloader_WORKSPACE_NAME)_CloudCover$encode)<closebracket><closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5)" \
   HTTP_METHOD GET                                                     \
   SAVE_FILE NO                                                        \
   OUTPUT_FILENAME "<Unused>"                                          \
   OUTPUT_DIRECTORY "<Unused>"                                         \
   FILE_EXTENSION "<Unused>"                                           \
   TARGET_ATTR "_response_body"                                        \
   FILE_PATH_ATTR "<Unused>"                                           \
   UPLOAD_FILE "<Unused>"                                              \
   UPLOAD_BODY "<Unused>"                                              \
   MULTIPART_UPLOAD <Unused>                                           \
   UPLOAD_CONTENT_TYPE "<Unused>"                                      \
   COMBINED_MULTIPART_TABLE                                            \
   REQUEST_HEADER_TABLE Authorization;@EvaluateExpression(FDIV,STRING_ENCODED,Basic<space><at>Value<openparen>_key_encoded<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5) \
   ADDITIONAL_URL_PARAMETERS                                           \
   AUTH_USERNAME "<Unused>"                                            \
   AUTH_PASSWORD "<Unused>"                                            \
   AUTH_METHOD "<Unused>"                                              \
   TARGET_ATTRIBUTE_ENCODING auto-detect                               \
   RESPONSE_HEADER_LIST_ATTR ""                                        \
   STATUS_CODE_ATTR "_http_status_code"                                \
   ERROR_ATTR "_error"                                                 \
   CONNECTION_TIMEOUT_LENGTH 60                                        \
   TRANSFER_TIMEOUT_LENGTH 90                                          \
   FOLLOW_REDIRECTS Yes                                                \
   VERIFY_SSL_CERTIFICATES Yes                                         \
   NAMED_CONNECTION "<Unused>"                                         \
   USE_COOKIES No                                                      \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5_Output" \
   OUTPUT REJECTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5_<REJECTED>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5 <REJECTED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5_<REJECTED>"

# -------------------------------------------------------------------------

# check if we have to do the min bounding box calculation

INCLUDE [                                                              \
   if { {BB} == {MINBB} } {                                            \
      puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BBFunc @Force2D() @Bounds(MIN_BOUNDING,,)}; \
   } elseif { {BB} == {BB} } {                                         \
      puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BBFunc @Force2D() @Bounds(BOUNDING_BOX_AXIS_ALIGNED,,)}; \
   } else {                                                            \
      puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BBFunc @Bounds(BOUNDING_CUBE,,)}; \
   }                                                                   \
]

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_AREA" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BOX" \
        $($(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BBFunc)

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_BoundingBoxReplacer_BOX" \
   TEST "All Coordinates" == "All Coordinates"                         \
   OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_PASSED \
   OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_PASSED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_PASSED \
   TEST @Dimension() == 2                                              \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT" \
        @ZValue("")                                                    \
        @Coordinate(x,ALL,"coord"{}.x,FLATTEN_AGGREGATE,YES)           \
        @Coordinate(y,ALL,"coord"{}.y,FLATTEN_AGGREGATE,NO)            \
        @Coordinate(z,ALL,"coord"{}.z,FLATTEN_AGGREGATE,NO)            \
        @Dimension(2)                                                  \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT" \
        @Coordinate(x,ALL,"coord"{}.x,FLATTEN_AGGREGATE,YES)           \
        @Coordinate(y,ALL,"coord"{}.y,FLATTEN_AGGREGATE,NO)            \
        @Coordinate(z,ALL,"coord"{}.z,FLATTEN_AGGREGATE,NO)

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED \
   TEST @Dimension() == 2                                              \
   OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED_PASSED \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT"

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED_PASSED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_FAILED_PASSED \
   TEST "" == ""                                                       \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT" \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT"

# -------------------------------------------------------------------------

FACTORY_DEF {*} AttrSetFactory                                         \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_2 \
   COMMAND_PARM_EVALUATION SINGLE_PASS                                 \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_2_OUTPUT" \
   MULTI_FEATURE_MODE NO                                               \
   NULL_ATTR_MODE NO_OP                                                \
    ATTRSET_CREATE_DIRECTIVES _PROPAGATE_MISSING_FDIV                  \
    ATTR_ACTION { "" "date_param" "SET_TO" "ingestionDate:<openbracket><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_BEGIN$encode)<comma>%Y-%m-%d<closeparen>T00:00:00.000Z<space>TO<space><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_END$encode)<comma>%Y-%m-%d<closeparen>T23:59:00.000Z<closebracket>" }  \
    ATTR_ACTION { "" "poly" "SET_TO" "POLYGON<openparen><openparen><at>Value<openparen>coord<opencurly>0<closecurly>.x<closeparen><space><at>Value<openparen>coord<opencurly>0<closecurly>.y<closeparen><comma><at>Value<openparen>coord<opencurly>1<closecurly>.x<closeparen><space><at>Value<openparen>coord<opencurly>1<closecurly>.y<closeparen><comma><at>Value<openparen>coord<opencurly>2<closecurly>.x<closeparen><space><at>Value<openparen>coord<opencurly>2<closecurly>.y<closeparen><comma><at>Value<openparen>coord<opencurly>3<closecurly>.x<closeparen><space><at>Value<openparen>coord<opencurly>3<closecurly>.y<closeparen><comma><at>Value<openparen>coord<opencurly>4<closecurly>.x<closeparen><space><at>Value<openparen>coord<opencurly>4<closecurly>.y<closeparen><closeparen><closeparen>" }  \
    ATTR_ACTION { "" "product_type" "SET_TO" "FME_CONDITIONAL:DEFAULT_VALUE'producttype:S2MSI2A'BOOL_OP;OR;COMPOSITE_TEST;<Unused>;TEST $($(SentinelDownloader_WORKSPACE_NAME)_LEVEL$encode) = Level<space>1C'producttype:S2MSI1C'FME_NUM_CONDITIONS2___" } \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_2_OUTPUT"

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller        \
      INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_2_OUTPUT" \
   TARGET_URL "@EvaluateExpression(FDIV,STRING_ENCODED,https:<solidus><solidus>scihub.copernicus.eu<solidus>dhus<solidus>search?q=<openparen>footprint:<quote>Intersects<openparen><at>Value<openparen>poly<closeparen><closeparen><quote><space>AND<space>platformname:$($(SentinelDownloader_WORKSPACE_NAME)_platform$encode)<space><space>AND<space><at>Value<openparen>product_type<closeparen><space>AND<space><at>Value<openparen>date_param<closeparen><space>AND<space>cloudcoverpercentage:<openbracket>0<space>TO<space>$($(SentinelDownloader_WORKSPACE_NAME)_CloudCover$encode)<closebracket><closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller)" \
   HTTP_METHOD GET                                                     \
   SAVE_FILE NO                                                        \
   OUTPUT_FILENAME "<Unused>"                                          \
   OUTPUT_DIRECTORY "<Unused>"                                         \
   FILE_EXTENSION "<Unused>"                                           \
   TARGET_ATTR "_response_body"                                        \
   FILE_PATH_ATTR "<Unused>"                                           \
   UPLOAD_FILE "<Unused>"                                              \
   UPLOAD_BODY "<Unused>"                                              \
   MULTIPART_UPLOAD <Unused>                                           \
   UPLOAD_CONTENT_TYPE "<Unused>"                                      \
   COMBINED_MULTIPART_TABLE                                            \
   REQUEST_HEADER_TABLE Authorization;@EvaluateExpression(FDIV,STRING_ENCODED,Basic<space><at>Value<openparen>_key_encoded<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller) \
   ADDITIONAL_URL_PARAMETERS                                           \
   AUTH_USERNAME "<Unused>"                                            \
   AUTH_PASSWORD "<Unused>"                                            \
   AUTH_METHOD "<Unused>"                                              \
   TARGET_ATTRIBUTE_ENCODING auto-detect                               \
   RESPONSE_HEADER_LIST_ATTR ""                                        \
   STATUS_CODE_ATTR "_http_status_code"                                \
   ERROR_ATTR "_error"                                                 \
   CONNECTION_TIMEOUT_LENGTH 60                                        \
   TRANSFER_TIMEOUT_LENGTH 90                                          \
   FOLLOW_REDIRECTS Yes                                                \
   VERIFY_SSL_CERTIFICATES Yes                                         \
   NAMED_CONNECTION "<Unused>"                                         \
   USE_COOKIES No                                                      \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_Output" \
   OUTPUT REJECTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_<REJECTED>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller <REJECTED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_<REJECTED>"

# -------------------------------------------------------------------------

# Wipe out the source setting if it was untouched from the default setting

DEFAULT_MACRO $(SentinelDownloader_WORKSPACE_NAME)_Reprojector_SOURCE "Read from feature"

INCLUDE [if { {Read from feature} == {Read from feature} } {           \
            puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_Reprojector_SOURCE} \
         }                                                             \
        ]

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Reprojector       \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_GeometryFilter_POINT" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Reprojector_REPROJECTED" \
        @Reproject($($(SentinelDownloader_WORKSPACE_NAME)_Reprojector_SOURCE),"LL-WGS84",NearestNeighbor,PreserveCells,$(SentinelDownloader_WORKSPACE_NAME)_Reprojector,"COORD_SYS_WARNING",RASTER_TOLERANCE,0.0)

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Reprojector_REPROJECTED" \
   TEST "Specify Coordinate" == "All Coordinates"                      \
   OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_PASSED \
   OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_PASSED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_PASSED \
   TEST @Dimension() == 2                                              \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
        @ZValue("")                                                    \
        @Coordinate(x,ALL,"<Unused>"{}.x,FLATTEN_AGGREGATE,YES)        \
        @Coordinate(y,ALL,"<Unused>"{}.y,FLATTEN_AGGREGATE,NO)         \
        @Coordinate(z,ALL,"<Unused>"{}.z,FLATTEN_AGGREGATE,NO)         \
        @Dimension(2)                                                  \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
        @Coordinate(x,ALL,"<Unused>"{}.x,FLATTEN_AGGREGATE,YES)        \
        @Coordinate(y,ALL,"<Unused>"{}.y,FLATTEN_AGGREGATE,NO)         \
        @Coordinate(z,ALL,"<Unused>"{}.z,FLATTEN_AGGREGATE,NO)

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED \
   TEST @Dimension() == 2                                              \
   OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED_PASSED \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
        "_x" @Coordinate(x,"0",FLATTEN_AGGREGATE,YES)                  \
        "_y" @Coordinate(y,"0",FLATTEN_AGGREGATE,NO)                   \
        "_z" @Coordinate(z,"0",FLATTEN_AGGREGATE,NO)

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED_PASSED \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_FAILED_PASSED \
   TEST "" == ""                                                       \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
        "_x" @Coordinate(x,"0",FLATTEN_AGGREGATE,YES)                  \
        "_y" @Coordinate(y,"0",FLATTEN_AGGREGATE,NO)                   \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
        "_x" @Coordinate(x,"0",FLATTEN_AGGREGATE,YES)                  \
        "_y" @Coordinate(y,"0",FLATTEN_AGGREGATE,NO)                   \
        @SupplyAttributes("_z","")

# -------------------------------------------------------------------------

FACTORY_DEF {*} AttrSetFactory                                         \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator  \
   COMMAND_PARM_EVALUATION SINGLE_PASS                                 \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_CoordinateExtractor_OUTPUT" \
   MULTI_FEATURE_MODE NO                                               \
   NULL_ATTR_MODE NO_OP                                                \
    ATTRSET_CREATE_DIRECTIVES _PROPAGATE_MISSING_FDIV                  \
    ATTR_ACTION { "" "date_param" "SET_TO" "ingestionDate:<openbracket><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_BEGIN$encode)<comma>%Y-%m-%d<closeparen>T00:00:00.000Z<space>TO<space><at>DateTimeFormat<openparen>$($(SentinelDownloader_WORKSPACE_NAME)_END$encode)<comma>%Y-%m-%d<closeparen>T23:59:00.000Z<closebracket>" }  \
    ATTR_ACTION { "" "product_type" "SET_TO" "FME_CONDITIONAL:DEFAULT_VALUE'producttype:S2MSI2A'BOOL_OP;OR;COMPOSITE_TEST;<Unused>;TEST $($(SentinelDownloader_WORKSPACE_NAME)_LEVEL$encode) = Level<space>1C'producttype:S2MSI1C'FME_NUM_CONDITIONS2___" } \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_OUTPUT"

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3      \
      INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_AttributeCreator_OUTPUT" \
   TARGET_URL "@EvaluateExpression(FDIV,STRING_ENCODED,https:<solidus><solidus>scihub.copernicus.eu<solidus>dhus<solidus>search?q=<openparen>footprint:<quote>Intersects<openparen><at>Value<openparen>_x<closeparen><space><at>Value<openparen>_y<closeparen><closeparen><quote><space>AND<space>platformname:$($(SentinelDownloader_WORKSPACE_NAME)_platform$encode)<space>AND<space><at>Value<openparen>product_type<closeparen><space>AND<space><at>Value<openparen>date_param<closeparen><space>AND<space>cloudcoverpercentage:<openbracket>0<space>TO<space>$($(SentinelDownloader_WORKSPACE_NAME)_CloudCover$encode)<closebracket><closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3)" \
   HTTP_METHOD GET                                                     \
   SAVE_FILE NO                                                        \
   OUTPUT_FILENAME "<Unused>"                                          \
   OUTPUT_DIRECTORY "<Unused>"                                         \
   FILE_EXTENSION "<Unused>"                                           \
   TARGET_ATTR "_response_body"                                        \
   FILE_PATH_ATTR "<Unused>"                                           \
   UPLOAD_FILE "<Unused>"                                              \
   UPLOAD_BODY "<Unused>"                                              \
   MULTIPART_UPLOAD <Unused>                                           \
   UPLOAD_CONTENT_TYPE "<Unused>"                                      \
   COMBINED_MULTIPART_TABLE                                            \
   REQUEST_HEADER_TABLE Authorization;@EvaluateExpression(FDIV,STRING_ENCODED,Basic<space><at>Value<openparen>_key_encoded<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3) \
   ADDITIONAL_URL_PARAMETERS                                           \
   AUTH_USERNAME "<Unused>"                                            \
   AUTH_PASSWORD "<Unused>"                                            \
   AUTH_METHOD "<Unused>"                                              \
   TARGET_ATTRIBUTE_ENCODING auto-detect                               \
   RESPONSE_HEADER_LIST_ATTR ""                                        \
   STATUS_CODE_ATTR "_http_status_code"                                \
   ERROR_ATTR "_error"                                                 \
   CONNECTION_TIMEOUT_LENGTH 60                                        \
   TRANSFER_TIMEOUT_LENGTH 90                                          \
   FOLLOW_REDIRECTS Yes                                                \
   VERIFY_SSL_CERTIFICATES Yes                                         \
   NAMED_CONNECTION "<Unused>"                                         \
   USE_COOKIES No                                                      \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3_Output" \
   OUTPUT REJECTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3_<REJECTED>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3 <REJECTED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3_<REJECTED>"

# -------------------------------------------------------------------------

FACTORY_DEF * XFMapFactory                                             \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter     \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_Output" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_3_Output" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_5_Output" \
   XML_STREAM "_response_body"                                         \
   XFMAP_FEATURE_PATHS_EXPRESSION "entry"                              \
   MERGE_ATTRIBUTES_FROM_INPUT No                                      \
   REJECT_FEATURES_WITH_NO_FRAGMENTS YES                               \
   OUTPUT MAPPED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_FRAGMENTS" \
   OUTPUT INVALID FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_<REJECTED>"

# -------------------------------------------------------------------------

# The default behaviour is to abort on any feature entering the transformer.

# If Workbench has set the _WB_BYPASS_TERMINATION macro to a value of "Yes",

# then the features will instead be passed through with a feature type of

# __WB_BYPASS_TERMINATOR__, which Workbench will send to a visualizer or

# somesuch.

DEFAULT_MACRO _WB_BYPASS_TERMINATION No

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Terminator_2      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_<REJECTED>" \
   TEST "$(_WB_BYPASS_TERMINATION)" == Yes                             \
   OUTPUT PASSED FEATURE_TYPE __WB_BYPASS_TERMINATOR__                 \
      @SupplyAttributes(_wb_termination_feature_type,@FeatureType())   \
      @SupplyAttributes(ENCODED,_wb_termination_message,"Translation<space>Terminated.<space>There<space>are<space>zero<space>search<space>results<space>with<space>your<space>parameters.<lf>To<space>get<space>results<comma><space>please<space>change<space>the<space>parameters<comma><space>e.g.<space>the<space>ingestion<space>date<space>or<space>the<space>maximum<space>cloud<space>coverage<space>percentage.") \
      @SupplyAttributes(_wb_termination_xformer,"$(SentinelDownloader_WORKSPACE_NAME)_Terminator_2") \
      @SupplyAttributes(_wb_termination_feature,Yes)                   \
   OUTPUT FAILED FEATURE_TYPE * @Abort(ENCODED,"Translation<space>Terminated.<space>There<space>are<space>zero<space>search<space>results<space>with<space>your<space>parameters.<lf>To<space>get<space>results<comma><space>please<space>change<space>the<space>parameters<comma><space>e.g.<space>the<space>ingestion<space>date<space>or<space>the<space>maximum<space>cloud<space>coverage<space>percentage.")

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester_2          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_FRAGMENTS" \
   TEST "@EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_LEVEL$encode),$(SentinelDownloader_WORKSPACE_NAME)_Tester_2)" = Level<space>2A ENCODED \
   BOOLEAN_OPERATOR AND                                                \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_2_PASSED" \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_2_FAILED"

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester_6          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_2_FAILED" \
   CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>xml_fragment<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_6)" CONTAINS _MSIL1C_ ENCODED \
   BOOLEAN_OPERATOR AND                                                \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED" \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_FAILED"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6 PASSED Splitter" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED_0_2wDJ2thxkXc=" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED_1_JvzDlcPjfkQ="

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Logger_3_Logger   \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_FAILED" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_3_LOGGED" \
                 @Log(ENCODED, "<dollar><openparen>SentinelDownloader_WORKSPACE_NAME<closeparen>_Logger_3:<space>Unfortunately<comma><space>the<space>search<space>results<space>do<space>not<space>match<space>the<space>search<space>criteria.","<Unused>","20","",WARN,NONE,$(SentinelDownloader_WORKSPACE_NAME)_Logger_3_c719dfaa_5dc4_4f23_af8c_e00bcd28ad010)

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Logger_3 LOGGED Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_3_LOGGED"

# -------------------------------------------------------------------------

FACTORY_DEF * XFMapFactory                                             \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener_2    \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED_0_2wDJ2thxkXc=" \
   XML_STREAM "xml_fragment"                                           \
   XFMAP_FEATURE_PATHS_EXPRESSION "link"                               \
   XFMAP_FEATURE_PATHS_STRUCTURE "<lt>structure<space><space><lf>separator=<quote>.<quote><space><lf>map-empty-elements=<quote>yes<quote><space><lf>matched-prefix=<quote>attributes<quote><space><lf>matched-attributes=<quote>yes<quote><space><lf>cardinality=<quote>+<opencurly>?<closecurly><quote><lf>except-expression=<quote><quote><lf>structure-prefix=<quote><quote><lf>child-position-attribute=<quote><quote><lf>attribute-identifier=<quote><quote><lf>ui-mode=<quote>basic<quote><solidus><gt>" \
   OUTPUT_ONE_FEATURE_PER_INPUT yes                                    \
   OUTPUT MAPPED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener_2_OUTPUT"

# -------------------------------------------------------------------------

DEFAULT_MACRO WB_CURRENT_CONTEXT

MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2_VAR key

INCLUDE [if {{Global} == {Local}} {                                    \
  puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2_VAR $(WB_CURRENT_CONTEXT)_key}; \
};

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2 \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener_2_OUTPUT" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2_OUTPUT" \
       @GlobalVariable(fme_encoded,$($(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2_VAR),fme_result_attribute,_keyAPI)

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4      \
      INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_2_OUTPUT" \
   TARGET_URL "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>link.href<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4)" \
   HTTP_METHOD GET                                                     \
   SAVE_FILE YES                                                       \
   OUTPUT_FILENAME "@EvaluateExpression(FDIV,STRING,$($(SentinelDownloader_WORKSPACE_NAME)_zip_output$encode),$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4)" \
   OUTPUT_DIRECTORY "<Unused>"                                         \
   FILE_EXTENSION "<Unused>"                                           \
   TARGET_ATTR "<Unused>"                                              \
   FILE_PATH_ATTR "_response_file_path"                                \
   UPLOAD_FILE "<Unused>"                                              \
   UPLOAD_BODY "<Unused>"                                              \
   MULTIPART_UPLOAD <Unused>                                           \
   UPLOAD_CONTENT_TYPE "<Unused>"                                      \
   COMBINED_MULTIPART_TABLE                                            \
   REQUEST_HEADER_TABLE Authorization;@EvaluateExpression(FDIV,STRING_ENCODED,Basic<space><at>Value<openparen>_keyAPI<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4) \
   ADDITIONAL_URL_PARAMETERS                                           \
   AUTH_USERNAME "<Unused>"                                            \
   AUTH_PASSWORD "<Unused>"                                            \
   AUTH_METHOD "<Unused>"                                              \
   TARGET_ATTRIBUTE_ENCODING <Unused>                                  \
   RESPONSE_HEADER_LIST_ATTR ""                                        \
   STATUS_CODE_ATTR "_http_status_code"                                \
   ERROR_ATTR "_error"                                                 \
   CONNECTION_TIMEOUT_LENGTH 60                                        \
   TRANSFER_TIMEOUT_LENGTH 90                                          \
   FOLLOW_REDIRECTS Yes                                                \
   VERIFY_SSL_CERTIFICATES Yes                                         \
   NAMED_CONNECTION "<Unused>"                                         \
   USE_COOKIES No                                                      \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4_Output" \
   OUTPUT REJECTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4_<REJECTED>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4 <REJECTED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4_<REJECTED>"

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester            \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_2_PASSED" \
   CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>xml_fragment<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester)" CONTAINS _MSIL2A_ ENCODED \
   BOOLEAN_OPERATOR AND                                                \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED" \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_FAILED"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Tester PASSED Splitter" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED_0_RcTV0oRQBVQ=" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED_1_37PvHh52dhg="

# -------------------------------------------------------------------------

FACTORY_DEF * XFMapFactory                                             \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED_1_37PvHh52dhg=" \
   XML_STREAM "xml_fragment"                                           \
   XFMAP_FEATURE_PATHS_EXPRESSION "link"                               \
   XFMAP_FEATURE_PATHS_STRUCTURE "<lt>structure<space><space><lf>separator=<quote>.<quote><space><lf>map-empty-elements=<quote>yes<quote><space><lf>matched-prefix=<quote>attributes<quote><space><lf>matched-attributes=<quote>yes<quote><space><lf>cardinality=<quote>+<opencurly>?<closecurly><quote><lf>except-expression=<quote><quote><lf>structure-prefix=<quote><quote><lf>child-position-attribute=<quote><quote><lf>attribute-identifier=<quote><quote><lf>ui-mode=<quote>basic<quote><solidus><gt>" \
   OUTPUT_ONE_FEATURE_PER_INPUT yes                                    \
   OUTPUT MAPPED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener_OUTPUT"

# -------------------------------------------------------------------------

DEFAULT_MACRO WB_CURRENT_CONTEXT

MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_VAR key

INCLUDE [if {{Global} == {Local}} {                                    \
  puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_VAR $(WB_CURRENT_CONTEXT)_key}; \
};

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFlattener_OUTPUT" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_OUTPUT" \
       @GlobalVariable(fme_encoded,$($(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_VAR),fme_result_attribute,_keyAPI)

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2      \
      INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_VariableRetriever_OUTPUT" \
   TARGET_URL "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>link.href<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2)" \
   HTTP_METHOD GET                                                     \
   SAVE_FILE YES                                                       \
   OUTPUT_FILENAME "@EvaluateExpression(FDIV,STRING,$($(SentinelDownloader_WORKSPACE_NAME)_zip_output$encode),$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2)" \
   OUTPUT_DIRECTORY "<Unused>"                                         \
   FILE_EXTENSION "<Unused>"                                           \
   TARGET_ATTR "<Unused>"                                              \
   FILE_PATH_ATTR "_response_file_path"                                \
   UPLOAD_FILE "<Unused>"                                              \
   UPLOAD_BODY "<Unused>"                                              \
   MULTIPART_UPLOAD <Unused>                                           \
   UPLOAD_CONTENT_TYPE "<Unused>"                                      \
   COMBINED_MULTIPART_TABLE                                            \
   REQUEST_HEADER_TABLE Authorization;@EvaluateExpression(FDIV,STRING_ENCODED,Basic<space><at>Value<openparen>_keyAPI<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2) \
   ADDITIONAL_URL_PARAMETERS                                           \
   AUTH_USERNAME "<Unused>"                                            \
   AUTH_PASSWORD "<Unused>"                                            \
   AUTH_METHOD "<Unused>"                                              \
   TARGET_ATTRIBUTE_ENCODING <Unused>                                  \
   RESPONSE_HEADER_LIST_ATTR ""                                        \
   STATUS_CODE_ATTR "_http_status_code"                                \
   ERROR_ATTR "_error"                                                 \
   CONNECTION_TIMEOUT_LENGTH 60                                        \
   TRANSFER_TIMEOUT_LENGTH 90                                          \
   FOLLOW_REDIRECTS Yes                                                \
   VERIFY_SSL_CERTIFICATES Yes                                         \
   NAMED_CONNECTION "<Unused>"                                         \
   USE_COOKIES No                                                      \
   OUTPUT OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2_Output" \
   OUTPUT REJECTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2_<REJECTED>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2 <REJECTED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2_<REJECTED>"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Junction          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_2_Output" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_HTTPCaller_4_Output" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Junction_Output"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_FilenamePartExtractor \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Junction_Output" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FilenamePartExtractor_OUTPUT" \
      "_dirpath" @Filenamepart(ENCODED,DIRNAME,"@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>_response_file_path<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_FilenamePartExtractor)")

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2 Input Input Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FilenamePartExtractor_OUTPUT" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_Input"

MACRO ZipExtractor_WORKSPACE_NAME $(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2

MACRO $(ZipExtractor_WORKSPACE_NAME)_XFORMER_NAME $(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2

MACRO $(ZipExtractor_WORKSPACE_NAME)_TRANSFORMER_GROUP 

MACRO $(ZipExtractor_WORKSPACE_NAME)___COMPOUND_PARAMETERS 

MACRO $(ZipExtractor_WORKSPACE_NAME)_SUB_DOC_NAME ZipExtractor

MACRO $(ZipExtractor_WORKSPACE_NAME)_ZIP_PATH @Value(_response_file_path)

MACRO $(ZipExtractor_WORKSPACE_NAME)_ROOT_FOLDER @Value(_dirpath)

MACRO $(ZipExtractor_WORKSPACE_NAME)_REPLACE No

MACRO $(ZipExtractor_WORKSPACE_NAME)_RECURSIVE No

MACRO $(ZipExtractor_WORKSPACE_NAME)_PRESERVE No

MACRO $(ZipExtractor_WORKSPACE_NAME)_EXT_S 

MACRO $(ZipExtractor_WORKSPACE_NAME)_EXT_N 

DEFAULT_MACRO ZipExtractor_WORKSPACE_NAME ""

INCLUDE [puts {MACRO WB_OLD_CONTEXT_$(ZipExtractor_WORKSPACE_NAME) $(WB_CURRENT_CONTEXT)}; \
         puts {MACRO WB_CURRENT_CONTEXT $(ZipExtractor_WORKSPACE_NAME)}]

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_Input1610612239 Input Splitter" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_Input"            \
  OUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_Input"

# -------------------------------------------------------------------------

Tcl2 proc $(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher_doFetch {} { \
   foreach {name val} {"__unzipper.zip_path {$($(ZipExtractor_WORKSPACE_NAME)_ZIP_PATH$encode)} __unzipper.root_folder {$($(ZipExtractor_WORKSPACE_NAME)_ROOT_FOLDER$encode)} __unzipper.replace {$($(ZipExtractor_WORKSPACE_NAME)_REPLACE$encode)} __unzipper.recursive {$($(ZipExtractor_WORKSPACE_NAME)_RECURSIVE$encode)} __unzipper.preserve {$($(ZipExtractor_WORKSPACE_NAME)_PRESERVE$encode)} __unzipper.ext_s {$($(ZipExtractor_WORKSPACE_NAME)_EXT_S$encode)} __unzipper.ext_n {$($(ZipExtractor_WORKSPACE_NAME)_EXT_N$encode)}"} { \
        if { [string match {*<at>*} $val] == 1 } {                     \
            set val [FME_Execute EvaluateExpression {STRING} $val {$(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher}]; \
        } elseif {[string match {*FME_CONDITIONAL*} $val] == 1} {      \
            set val [FME_Execute EvaluateExpression {STRING} $val {$(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher}]; \
        } else {                                                       \
            set val [FME_DecodeTextOrAttr $val];                       \
        };                                                             \
      FME_SetAttribute [FME_DecodeText $name] $val                     \
   }                                                                   \
}

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher        \
   INPUT  FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_Input"          \
   OUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher_OUTPUT" \
        @Tcl2($(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher_doFetch)

# -------------------------------------------------------------------------

FME_PYTHON_PATH "$(FME_MF_DIR)"

FACTORY_DEF * PythonFactory                                            \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_PythonCaller            \
   INPUT  FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_ParameterFetcher_OUTPUT" \
   SYMBOL_NAME ZipExtractor                                            \
   PYTHON_NAMESPACE FMEOBJECTS                                         \
   SOURCE_CODE <lf>#<space>2018-06-14<comma><space><space>Takashi<space>Iijima<comma><space><space>Added<space>Allowable<space>Source<solidus>Nested<space>Zip<space>File<space>Extention<openparen>s<closeparen><space>parameter.<lf>#<space>2016-01-25<comma><space><space>Takashi<space>Iijima<comma><space><space>Updated<space>to<space>trim<space>leading<space>and<space>trailing<space>whitespaces<space>of<space>specified<space>path<space>strings.<lf>#<space>2016-01-23<comma><space><space>Takashi<space>Iijima<comma><space><space>Updated:<lf>#<space>-<space>added<space>function<space>to<space>check<space>file<space>extension<space>to<space>prevent<space>extracting<space>non-archiver<space>zip<space>files.<space>e.g.<space>Excel<space><openparen>*.xlsx<closeparen><space>etc.<lf>#<space>-<space>added<space>codes<space>to<space>create<space>desitnation<space>root<space>folder<space>if<space>it<space>is<space>specified<space>but<space>doesn<apos>t<space>exist.<lf>#<space>-<space>added<space>option<space>to<space>preserve<space>nested<space>zip<space>files<space>after<space>unzipping<space>them.<lf>#<space>-<space>added<space><quote>path_depth<quote><space>attribute<space>to<space>output<space>features.<lf>#<space>2016-01-21<comma><space><space>Takashi<space>Iijima<comma><space><space>Original<space>Implementation<lf><lf>import<space>fmeobjects<comma><space>zipfile<comma><space>os<lf><lf>class<space>ZipExtractor<openparen>object<closeparen>:<lf><space><space><space><space>def<space>__init__<openparen>self<closeparen>:<lf><space><space><space><space><space><space><space><space>self.logger<space>=<space>fmeobjects.FMELogFile<openparen><closeparen><lf><space><space><space><space><space><space><space><space>self.kFlagFile<space>=<space><apos>file<apos><lf><space><space><space><space><space><space><space><space>self.kFlagDirectory<space>=<space><apos>directory<apos><lf><space><space><space><space><space><space><space><space>self.kFlagReject<space>=<space><apos>reject<apos><lf><space><space><space><space><space><space><space><space>self.kFlagTerminate<space>=<space><apos>terminate<apos><lf><space><space><space><space><space><space><space><space>self.zipExtS<space>=<space>set<openparen><openbracket><apos>.zip<apos><closebracket><closeparen><lf><space><space><space><space><space><space><space><space>self.zipExtN<space>=<space>set<openparen><openbracket><apos>.zip<apos><closebracket><closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space>def<space>isZipFileS<openparen>self<comma><space>path<closeparen>:<lf><space><space><space><space><space><space><space><space>_<comma><space>ext<space>=<space>os.path.splitext<openparen>path<closeparen><lf><space><space><space><space><space><space><space><space>return<space>ext.lower<openparen><closeparen><space>in<space>self.zipExtS<space>and<space>zipfile.is_zipfile<openparen>path<closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space>def<space>isZipFileN<openparen>self<comma><space>path<closeparen>:<lf><space><space><space><space><space><space><space><space>_<comma><space>ext<space>=<space>os.path.splitext<openparen>path<closeparen><lf><space><space><space><space><space><space><space><space>return<space>ext.lower<openparen><closeparen><space>in<space>self.zipExtN<space>and<space>zipfile.is_zipfile<openparen>path<closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space>def<space>input<openparen>self<comma><space>feature<closeparen>:<lf><space><space><space><space><space><space><space><space>#<space>Retrieve<space>parameter<space>values<space>from<space>feature<space>attributes<comma><space>then<space>remove<space>the<space>attributes.<lf><space><space><space><space><space><space><space><space>#<space>Zip<space>path<space>may<space>end<space>with<space>a<space>path<space>separator<space>if<space>extracted<space>by<space>the<space>FilenamePartExtractor<space>as<space><quote>_dirpath<quote>.<space><lf><space><space><space><space><space><space><space><space>zipPath<space>=<space>feature.getAttribute<openparen><apos>__unzipper.zip_path<apos><closeparen>.strip<openparen><closeparen>.rstrip<openparen><apos><backslash><backslash><solidus><apos><closeparen><lf><space><space><space><space><space><space><space><space>rootFolder<space>=<space>feature.getAttribute<openparen><apos>__unzipper.root_folder<apos><closeparen>.strip<openparen><closeparen><lf><space><space><space><space><space><space><space><space>replace<space>=<space><openparen>feature.getAttribute<openparen><apos>__unzipper.replace<apos><closeparen><space>==<space><apos>Yes<apos><closeparen><lf><space><space><space><space><space><space><space><space>self.recursive<space>=<space><openparen>feature.getAttribute<openparen><apos>__unzipper.recursive<apos><closeparen><space>==<space><apos>Yes<apos><closeparen><lf><space><space><space><space><space><space><space><space>self.preserve<space>=<space><openparen>feature.getAttribute<openparen><apos>__unzipper.preserve<apos><closeparen><space>==<space><apos>Yes<apos><closeparen><lf><space><space><space><space><space><space><space><space>extS<space>=<space>set<openparen>feature.getAttribute<openparen><apos>__unzipper.ext_s<apos><closeparen>.split<openparen><closeparen><closeparen><lf><space><space><space><space><space><space><space><space>extN<space>=<space>set<openparen>feature.getAttribute<openparen><apos>__unzipper.ext_n<apos><closeparen>.split<openparen><closeparen><closeparen><lf><space><space><space><space><space><space><space><space>feature.removeAttrsWithPrefix<openparen><apos>__unzipper.<apos><closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>if<space>extS:<lf><space><space><space><space><space><space><space><space><space><space><space><space>self.zipExtS<space>=<space>set<openparen><openbracket><openparen>e<space>if<space>e.startswith<openparen><apos>.<apos><closeparen><space>else<space><openparen><apos>.%s<apos><space>%<space>e<closeparen><closeparen>.lower<openparen><closeparen><space>for<space>e<space>in<space>extS<closebracket><closeparen><lf><space><space><space><space><space><space><space><space>if<space>extN:<lf><space><space><space><space><space><space><space><space><space><space><space><space>self.zipExtN<space>=<space>set<openparen><openbracket><openparen>e<space>if<space>e.startswith<openparen><apos>.<apos><closeparen><space>else<space><openparen><apos>.%s<apos><space>%<space>e<closeparen><closeparen>.lower<openparen><closeparen><space>for<space>e<space>in<space>extN<closebracket><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>#<space>If<space>destination<space>root<space>folder<space>is<space>specified<space>but<space>doesn<apos>t<space>exist<comma><space>try<space>creating<space>the<space>directory.<lf><space><space><space><space><space><space><space><space>isRootValid<space>=<space>True<lf><space><space><space><space><space><space><space><space>if<space>rootFolder<space>and<space>not<space>os.path.exists<openparen>rootFolder<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space>try:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>os.makedirs<openparen>rootFolder<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>except:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>isRootValid<space>=<space>False<lf><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>#<space>If<space>specified<space>zip<space>file<space>or<space>destination<space>root<space>folder<space>is<space>invalid<comma><space>reject<space>the<space>input<space>feature.<lf><space><space><space><space><space><space><space><space>if<space>not<space>os.path.exists<openparen>zipPath<closeparen><space>or<space>not<space>self.isZipFileS<openparen>zipPath<closeparen><space>or<space>not<space>isRootValid:<lf><space><space><space><space><space><space><space><space><space><space><space><space>self.logger.logMessageString<openparen><apos>Specified<space>zip<space>file<space>or<space>destination<space>root<space>folder<space>is<space>invalid.<apos><comma><space><space><backslash><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>fmeobjects.FME_WARN<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>feature.setAttribute<openparen><apos>__unzipper.flag<apos><comma><space>self.kFlagReject<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>self.pyoutput<openparen>feature<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>return<lf><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>#<space>Define<space>destination<space>folder<space>path:<space><lt>root<space>folder<gt><solidus><lt>source<space>zip<space>file<space>name<space>without<space>extension<gt><lf><space><space><space><space><space><space><space><space>#<space>If<space>root<space>folder<space>is<space>not<space>specified<comma><space>treat<space>the<space>folder<space>containing<space>source<space>zip<space>file<space>as<space>root<space>folder.<lf><space><space><space><space><space><space><space><space>zipPath<space>=<space>os.path.abspath<openparen>zipPath<closeparen><lf><space><space><space><space><space><space><space><space>zipFolder<comma><space>zipName<space>=<space>os.path.split<openparen>zipPath<closeparen><lf><space><space><space><space><space><space><space><space>destFolder<space>=<space>os.path.join<openparen>os.path.abspath<openparen>rootFolder<closeparen><space>if<space>rootFolder<space>else<space>zipFolder<comma><space>zipName<openbracket>:-4<closebracket><closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>try:<lf><space><space><space><space><space><space><space><space><space><space><space><space>#<space>If<space>the<space>destination<space>folder<space>exists<comma><lf><space><space><space><space><space><space><space><space><space><space><space><space>#<space>-<space>remove<space>the<space>existing<space>folder<space>and<space>all<space>files<space>within<space>it<space>when<space>REPLACE<space>is<space>set<space>to<space>Yes<comma><lf><space><space><space><space><space><space><space><space><space><space><space><space>#<space>-<space>add<space>suffix<space>to<space>the<space>folder<space>path<space>when<space>REPLACE<space>is<space>set<space>to<space>No.<lf><space><space><space><space><space><space><space><space><space><space><space><space>if<space>os.path.exists<openparen>destFolder<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>if<space>replace:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>for<space>dirpath<comma><space>dirs<comma><space>files<space>in<space>os.walk<openparen>destFolder<comma><space>topdown=False<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>for<space>name<space>in<space>files:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>os.remove<openparen>os.path.join<openparen>dirpath<comma><space>name<closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>for<space>name<space>in<space>dirs:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>os.rmdir<openparen>os.path.join<openparen>dirpath<comma><space>name<closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>os.rmdir<openparen>destFolder<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>else:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>format<comma><space>n<space>=<space><apos>%s_%d<apos><comma><space>1<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>while<space>os.path.exists<openparen>format<space>%<space><openparen>destFolder<comma><space>n<closeparen><closeparen>:<space>n<space>+=<space>1<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>destFolder<space>=<space>format<space>%<space><openparen>destFolder<comma><space>n<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space><space><space><space><space>#<space>Extract<space>the<space>zip<space>file<space>and<space>output<space>features<space>containing<space>extracted<space>file<solidus>directory<space>path.<lf><space><space><space><space><space><space><space><space><space><space><space><space>self.pathInfos<space>=<space><openbracket><closebracket><space>#<space>tuples<space>list<space>-<space><openparen>file<space>or<space>directory<space>path<comma><space>flag:<space><apos>file<apos><space>or<space><apos>directory<apos><comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>self.extract<openparen>zipPath<comma><space>destFolder<comma><space>1<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>for<space>path<comma><space>flag<comma><space>depth<space>in<space>self.pathInfos:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>feat<space>=<space>feature.cloneAttributes<openparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>feat.setAttribute<openparen><apos>path_unix<apos><comma><space>path.replace<openparen><apos><backslash><backslash><apos><comma><space><apos><solidus><apos><closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>feat.setAttribute<openparen><apos>path_windows<apos><comma><space>path.replace<openparen><apos><solidus><apos><comma><space><apos><backslash><backslash><apos><closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>feat.setAttribute<openparen><apos>path_depth<apos><comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>feat.setAttribute<openparen><apos>__unzipper.flag<apos><comma><space>flag<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.pyoutput<openparen>feat<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space><space><space><space><space>except<space>Exception<space>as<space>ex:<lf><space><space><space><space><space><space><space><space><space><space><space><space>feature.setAttribute<openparen><apos>_error_message<apos><comma><space><apos>Unexpected<space>error:<space>%s<apos><space>%<space>ex<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>feature.setAttribute<openparen><apos>__unzipper.flag<apos><comma><space>self.kFlagTerminate<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>self.pyoutput<openparen>feature<closeparen><lf><space><space><space><space><space><space><space><space><lf><space><space><space><space>#<space>Extract<space>a<space>zip<space>file.<lf><space><space><space><space>def<space>extract<openparen>self<comma><space>zipPath<comma><space>destPath<comma><space>depth<closeparen>:<lf><space><space><space><space><space><space><space><space>with<space>zipfile.ZipFile<openparen>zipPath<closeparen><space>as<space>z:<space>z.extractall<openparen>destPath<closeparen><lf><space><space><space><space><space><space><space><space>self.findFiles<openparen>destPath<comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><lf><space><space><space><space>#<space>Find<space>and<space>collect<space>extracted<space>file<solidus>directory<space>paths.<lf><space><space><space><space>def<space>findFiles<openparen>self<comma><space>dirPath<comma><space>depth<closeparen>:<lf><space><space><space><space><space><space><space><space>self.pathInfos.append<openparen><openparen>dirPath<comma><space>self.kFlagDirectory<comma><space>depth<closeparen><closeparen><lf><space><space><space><space><space><space><space><space>depth<space>+=<space>1<lf><space><space><space><space><space><space><space><space>for<space>fname<space>in<space>os.listdir<openparen>dirPath<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space>path<space>=<space>os.path.join<openparen>dirPath<comma><space>fname<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>if<space>os.path.isdir<openparen>path<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.findFiles<openparen>path<comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>elif<space>self.recursive<space>and<space>self.isZipFileN<openparen>path<closeparen>:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>if<space>self.preserve:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.pathInfos.append<openparen><openparen>path<comma><space>self.kFlagFile<comma><space>depth<closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.extract<openparen>path<comma><space>os.path.join<openparen>dirPath<comma><space>fname<openbracket>:-4<closebracket><closeparen><comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>else:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.extract<openparen>path<comma><space>os.path.join<openparen>dirPath<comma><space>fname<openbracket>:-4<closebracket><closeparen><comma><space>depth<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>os.remove<openparen>path<closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space>else:<lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space>self.pathInfos.append<openparen><openparen>path<comma><space>self.kFlagFile<comma><space>depth<closeparen><closeparen><lf><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space><space> \
   OUTPUT PYOUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_PythonCaller_OUTPUT"

# -------------------------------------------------------------------------

Lookup $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_AttributeFilterLut \
  file ok                                                              \
  directory ok                                                         \
  reject ok                                                            \
  terminate ok                                                         \
  "" notok                                                             \
  ENCODED

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter         \
   INPUT  FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_PythonCaller_OUTPUT" \
   TEST @Lookup($(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_AttributeFilterLut,__unzipper.flag,ENCODED_ATTR) == "ok" \
   OUTPUT PASSED FEATURE_TYPE * @FeatureType(SET_FROM_ATTR, __unzipper.flag, $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter) \
   OUTPUT FAILED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<NULL>

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_NullFilter \
   INPUT FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<NULL> \
   TEST __unzipper.flag ATTRIBUTE_VALUE_NULL "" ENCODED                \
   OUTPUT PASSED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<NULL> \
   OUTPUT FAILED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<MISSING>

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_MissingFilter \
   INPUT FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<MISSING> \
   TEST __unzipper.flag ATTRIBUTE_IS_MISSING "" ENCODED                \
   OUTPUT PASSED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<MISSING> \
   OUTPUT FAILED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<UNFILTERED>

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_BlankFilter \
   INPUT FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<UNFILTERED> \
   TEST __unzipper.flag ATTRIBUTE_IS_EMPTY "" ENCODED                  \
   OUTPUT PASSED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<EMPTY> \
   OUTPUT FAILED FEATURE_TYPE $(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<UNFILTERED>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter <EMPTY> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<EMPTY>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter <MISSING> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<MISSING>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter <NULL> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<NULL>"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter <UNFILTERED> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_<UNFILTERED>"

# -------------------------------------------------------------------------

# Build the List removal function and regular expression if there was any list attributes to be removed.

# If not, then we will not have any extra list removal call to @RemoveAttributes, which speeds the

# normal, non-list removal especially when in Bulk Mode.  Note that this computation of the regular expressions is done

# once during mapping file parse time.

INCLUDE [                                                              \
   set listAttributeRemoveRegexps {};                                  \
   set anyList {no};                                                   \
   foreach attr [split ""] {                                           \
      set attr [FME_DecodeText $attr];                                 \
      set attr [regsub "{}$" $attr "{}.*"];                            \
      set attr [regsub -all "{}" $attr "\\{\[0-9\]+\\}"];              \
      append listAttributeRemoveRegexps ",^$attr$";                    \
      set anyList {yes};                                               \
   };                                                                  \
   if { ${anyList} == {no} } {                                         \
       puts {MACRO $(ZipExtractor_WORKSPACE_NAME)_AttributeRemover_LIST_FUNC } \
   } else {                                                            \
       puts "MACRO $(ZipExtractor_WORKSPACE_NAME)_AttributeRemover_LIST_FUNC @RemoveAttributes(fme_pcre_match\"$listAttributeRemoveRegexps\")" \
   };                                                                  \
]

FACTORY_DEF {*} TeeFactory                                             \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_AttributeRemover        \
   INPUT  FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_terminate" \
   OUTPUT { FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeRemover_OUTPUT" \
       @RemoveAttributes(fme_encoded,__unzipper.flag,path_depth,path_unix,path_windows) \
       $($(ZipExtractor_WORKSPACE_NAME)_AttributeRemover_LIST_FUNC)    \
        }

# -------------------------------------------------------------------------

# The default behaviour is to abort on any feature entering the transformer.

# If Workbench has set the _WB_BYPASS_TERMINATION macro to a value of "Yes",

# then the features will instead be passed through with a feature type of

# __WB_BYPASS_TERMINATOR__, which Workbench will send to a visualizer or

# somesuch.

DEFAULT_MACRO _WB_BYPASS_TERMINATION No

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(ZipExtractor_WORKSPACE_NAME)_Terminator              \
   INPUT  FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeRemover_OUTPUT" \
   TEST "$(_WB_BYPASS_TERMINATION)" == Yes                             \
   OUTPUT PASSED FEATURE_TYPE __WB_BYPASS_TERMINATOR__                 \
      @SupplyAttributes(_wb_termination_feature_type,@FeatureType())   \
      @SupplyAttributes(ENCODED,_wb_termination_message,"@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>_error_message<closeparen>,$(ZipExtractor_WORKSPACE_NAME)_Terminator)") \
      @SupplyAttributes(_wb_termination_xformer,"$(ZipExtractor_WORKSPACE_NAME)_Terminator") \
      @SupplyAttributes(_wb_termination_feature,Yes)                   \
   OUTPUT FAILED FEATURE_TYPE * @Abort(ENCODED,"@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>_error_message<closeparen>,$(ZipExtractor_WORKSPACE_NAME)_Terminator)")

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_File1610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_file" \
  OUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_File"            \
@RemoveAttributes(__unzipper.flag,_error_message)

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_<Rejected>1610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_reject" \
  OUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_<Rejected>"      \
@RemoveAttributes(path_unix,path_windows,path_depth,__unzipper.flag,_error_message)

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(ZipExtractor_WORKSPACE_NAME)_Directory1610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_AttributeFilter_directory" \
  OUTPUT FEATURE_TYPE "$(ZipExtractor_WORKSPACE_NAME)_Directory"       \
@RemoveAttributes(__unzipper.flag,_error_message)

INCLUDE [puts {MACRO WB_CURRENT_CONTEXT $(WB_OLD_CONTEXT_$(ZipExtractor_WORKSPACE_NAME))}]

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2 File Output Renamer/Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_File" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_File"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2 Directory Output Renamer/Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_Directory"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2 <Rejected> Output Renamer/Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_<Rejected>"

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester_4          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ZipExtractor_2_File" \
   CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>xml_fragment<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_4)" CONTAINS _MSIL2A_ ENCODED \
CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_4)" CONTAINS GRANULE ENCODED \
   BOOLEAN_OPERATOR AND                                                \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_4_PASSED" \
   OUTPUT FAILED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_4_FAILED"

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester_5          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_4_FAILED" \
   CASE_SENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_5)" CONTAINS_REGEX B<backslash>d<openparen><backslash>d|A<closeparen>.jp2 ENCODED \
CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_5)" CONTAINS TCI.jp2 ENCODED \
   BOOLEAN_OPERATOR OR                                                 \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_5_PASSED"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_5_PASSED" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_0

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_Condition_1 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_0 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) CONTAINS_REGEX _B0<openbracket>2348<closebracket>.jp2 ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = 10m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = All ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR 3)"                                   \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_10m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_1

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_Condition_2 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_1 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) CONTAINS_REGEX _B<openparen><openparen>0|8<closeparen><openparen><openbracket>567<closebracket>|A<closeparen>|11|12<closeparen>.jp2 ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = 20m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = All ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) NOT_CONTAINS_REGEX _B<openparen>0<openbracket>2348<closebracket>|<closeparen>.jp2 ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR (3 AND 4))"                           \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_20m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_2

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_Condition_3 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_2 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) CONTAINS_REGEX _B<openparen>0<openbracket>19<closebracket>|10<closeparen>.jp2 ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = 60m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = All ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) NOT_CONTAINS_REGEX _B0<openparen>2|3|4|5|6|7<closeparen>.jp2 ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) NOT_CONTAINS_REGEX _B8A.jp2 ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) NOT_CONTAINS_REGEX _B1<openparen>1|2<closeparen>.jp2 ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR (3 AND (4 AND 5 AND 6)))"             \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_60m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_3

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_Condition_4 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_3 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) CONTAINS_REGEX TCI ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6) = All ENCODED \
BOOLEAN_OPERATOR AND                                                   \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TCI \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_4

FACTORY_DEF * TeeFactory                                               \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_<lt>UNFILTERED<gt> \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TESTFILTERINPUTLINE_4 \
OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_<lt>UNFILTERED<gt>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6 <lt>UNFILTERED<gt> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_<lt>UNFILTERED<gt>"

# -------------------------------------------------------------------------

MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_OUTPUT_PORTS_ENCODED JPEG2000

MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_DIRECTIVES USE_SEARCH_ENVELOPE,NO,READER_META_ATTRIBUTES,fme_dataset<space>fme_basename,JPEG2000_EXPOSE_FORMAT_ATTRS,fme_basename<comma>char<openparen>50<closeparen>,READ_OFFSETS_IN_CS_UNITS,No,EXPOSE_ATTRS_GROUP,FME_DISCLOSURE_OPEN,JPEG2000_RDR_ADV_PARM_GROUP,FME_DISCLOSURE_OPEN,GROUP_BY_DATASET,No,PREFER_FILE_CS_UNITS,Yes

# Always provide an INTERACTION, otherwise the factory defaults to ENVELOPE_INTERSECTS

INCLUDE [if { ( {NONE} == {<Unused>} ) || ( {($INTERACT_OPTIONS)} == {} ) } { \
            puts {MACRO FCTQUERY_INTERACTION_LINE FCTQUERY_INTERACTION NONE}; \
         } else {                                                      \
            puts {MACRO FCTQUERY_INTERACTION_LINE FCTQUERY_INTERACTION "NONE"}; \
         }                                                             \
        ]

# Consolidate the attribute merge options to what the factory expects

DEFAULT_MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_COMBINE_ATTRS

INCLUDE [                                                              \
      if { {RESULT_ONLY} == {MERGE} } {                                \
         puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_COMBINE_ATTRS <Unused>"; \
      } else {                                                         \
         puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_COMBINE_ATTRS RESULT_ONLY"; \
      };                                                               \
   ]

INCLUDE [                                                              \
   puts {DEFAULT_MACRO FeatureReaderDataset_$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2 @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_unix<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2)}; \
]

FACTORY_DEF {*} QueryFactory                                           \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2   \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_10m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_20m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_60m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_6_TCI" \
   $(FCTQUERY_INTERACTION_LINE)                                        \
   COMBINE_ATTRIBUTES  { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_COMBINE_ATTRS) } \
   QUERYFCT_ATTRIBUTE_PREFIX { <Unused> }                              \
   COMBINE_GEOMETRY    { RESULT_ONLY }                                 \
   ENABLE_CACHE        { NO }                                          \
   QUERYFCT_TABLE_SEPARATOR { SPACE }                                  \
   READER_TYPE         { JPEG2000  }                                   \
   READER_DATASET      { "$(FeatureReaderDataset_$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2)" } \
   QUERYFCT_IDS        { "" }                                          \
   READER_DIRECTIVES   { META_MACROS,SourceREADER_META_ATTRIBUTES<comma><quote>fme_dataset<space>fme_basename<quote><comma>SourceGROUP_BY_DATASET<comma>No<comma>SourceEXPOSE_ATTRS_GROUP<comma>FME_DISCLOSURE_OPEN<comma>SourceJPEG2000_EXPOSE_FORMAT_ATTRS<comma><quote>fme_basename<comma>char<openparen>50<closeparen><quote><comma>SourceUSE_SEARCH_ENVELOPE<comma>NO<comma>SourceSEARCH_ENVELOPE_MINX<comma>0<comma>SourceSEARCH_ENVELOPE_MINY<comma>0<comma>SourceSEARCH_ENVELOPE_MAXX<comma>0<comma>SourceSEARCH_ENVELOPE_MAXY<comma>0<comma>SourceSEARCH_ENVELOPE_COORDINATE_SYSTEM<comma><comma>SourceCLIP_TO_ENVELOPE<comma>NO<comma>SourceJPEG2000_RDR_ADV_PARM_GROUP<comma>FME_DISCLOSURE_OPEN<comma>SourcePREFER_FILE_CS_UNITS<comma>Yes<comma>SourceREAD_OFFSETS_IN_CS_UNITS<comma>No,METAFILE,JPEG2000 } \
   QUERYFCT_OUTPUT     { "BASED_ON_CONNECTIONS" }                      \
   CONTINUE_ON_READER_ERROR YES                                        \
   QUERYFCT_RESULT_TAGS { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_OUTPUT_PORTS_ENCODED) } \
   QUERYFCT_SET_FME_FEATURE_TYPE YES                                   \
   READER_PARAMS_WWJD                                                  \
    { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_DIRECTIVES) } \
   TREAT_READER_PARAM_AMPERSANDS_AS_LITERALS YES                       \
   OUTPUT JPEG2000 FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_JPEG2000"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_2_JPEG2000" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_0

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_1 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_0 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B01 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B01 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_1

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_2 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_1 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B02 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B02 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_2

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_3 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_2 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B03 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B03 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_3

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_4 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_3 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B04 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B04 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_4

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_5 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_4 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B05 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B05 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_5

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_6 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_5 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B06 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B06 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_6

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_7 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_6 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B07 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B07 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_7

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_8 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_7 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B08 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B08 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_8

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_9 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_8 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B8A ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B8A \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_9

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_10 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_9 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B09 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B09 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_10

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_11 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_10 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B10 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B10 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_11

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_12 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_11 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B11 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B11 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_12

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_13 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_12 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX B12 ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B12 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_13

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_Condition_14 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_13 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5) CONTAINS_REGEX TCI ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TCI \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_14

FACTORY_DEF * TeeFactory                                               \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_<lt>UNFILTERED<gt> \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TESTFILTERINPUTLINE_14 \
OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_<lt>UNFILTERED<gt>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5 <lt>UNFILTERED<gt> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_<lt>UNFILTERED<gt>"

# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Tester_3          \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_4_PASSED" \
   CASE_SENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_3)" CONTAINS_REGEX B<backslash>d<openparen><backslash>d|A<closeparen>_<backslash>d<backslash>dm.jp2 ENCODED \
CASE_INSENSITIVE_TEST "@EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Tester_3)" CONTAINS TCI_10m ENCODED \
   BOOLEAN_OPERATOR OR                                                 \
   COMPOSITE_TEST_EXPR "<Unused>"                                      \
   OUTPUT PASSED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_3_PASSED"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_3_PASSED" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_0

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_Condition_1 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_0 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) CONTAINS R10m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = 10m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = All ENCODED \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) NOT_CONTAINS TCI_10m ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR 3) AND 4"                             \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_10m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_1

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_Condition_2 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_1 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) CONTAINS R20m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = 20m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = All ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) NOT_CONTAINS_REGEX _B<openparen>0<openbracket>2348<closebracket>|<closeparen>_20m.jp2 ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR (3 AND 4))"                           \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_20m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_2

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_Condition_3 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_2 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) CONTAINS R60m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = 60m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = All ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) NOT_CONTAINS_REGEX _B0<openparen>2|3|4|5|6|7<closeparen>_60m.jp2 ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) NOT_CONTAINS_REGEX _B8A_60m.jp2 ENCODED \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) NOT_CONTAINS_REGEX _B1<openparen>1|2<closeparen>_60m.jp2 ENCODED \
BOOLEAN_OPERATOR COMPOSITE                                             \
COMPOSITE_TEST_EXPR "1 AND (2 OR (3 AND (4 AND 5 AND 6)))"             \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_60m \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_3

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_Condition_4 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_3 \
CASE_INSENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_windows<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) CONTAINS_REGEX TCI_10m ENCODED \
TEST @EvaluateExpression(FDIV,STRING_ENCODED,$($(SentinelDownloader_WORKSPACE_NAME)_Band_Resolution$encode),$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3) = All ENCODED \
BOOLEAN_OPERATOR AND                                                   \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TCI \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_4

FACTORY_DEF * TeeFactory                                               \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_<lt>UNFILTERED<gt> \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TESTFILTERINPUTLINE_4 \
OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_<lt>UNFILTERED<gt>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3 <lt>UNFILTERED<gt> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_<lt>UNFILTERED<gt>"

# -------------------------------------------------------------------------

MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_OUTPUT_PORTS_ENCODED JPEG2000

MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_DIRECTIVES USE_SEARCH_ENVELOPE,NO,READER_META_ATTRIBUTES,fme_dataset<space>fme_basename,JPEG2000_EXPOSE_FORMAT_ATTRS,fme_basename<comma>char<openparen>50<closeparen>,READ_OFFSETS_IN_CS_UNITS,No,EXPOSE_ATTRS_GROUP,FME_DISCLOSURE_OPEN,JPEG2000_RDR_ADV_PARM_GROUP,FME_DISCLOSURE_OPEN,GROUP_BY_DATASET,No,PREFER_FILE_CS_UNITS,Yes

# Always provide an INTERACTION, otherwise the factory defaults to ENVELOPE_INTERSECTS

INCLUDE [if { ( {NONE} == {<Unused>} ) || ( {($INTERACT_OPTIONS)} == {} ) } { \
            puts {MACRO FCTQUERY_INTERACTION_LINE FCTQUERY_INTERACTION NONE}; \
         } else {                                                      \
            puts {MACRO FCTQUERY_INTERACTION_LINE FCTQUERY_INTERACTION "NONE"}; \
         }                                                             \
        ]

# Consolidate the attribute merge options to what the factory expects

DEFAULT_MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_COMBINE_ATTRS

INCLUDE [                                                              \
      if { {RESULT_ONLY} == {MERGE} } {                                \
         puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_COMBINE_ATTRS <Unused>"; \
      } else {                                                         \
         puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_COMBINE_ATTRS RESULT_ONLY"; \
      };                                                               \
   ]

INCLUDE [                                                              \
   puts {DEFAULT_MACRO FeatureReaderDataset_$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3 @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>path_unix<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3)}; \
]

FACTORY_DEF {*} QueryFactory                                           \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3   \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_10m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_20m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_60m" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_3_TCI" \
   $(FCTQUERY_INTERACTION_LINE)                                        \
   COMBINE_ATTRIBUTES  { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_COMBINE_ATTRS) } \
   QUERYFCT_ATTRIBUTE_PREFIX { <Unused> }                              \
   COMBINE_GEOMETRY    { RESULT_ONLY }                                 \
   ENABLE_CACHE        { NO }                                          \
   QUERYFCT_TABLE_SEPARATOR { SPACE }                                  \
   READER_TYPE         { JPEG2000  }                                   \
   READER_DATASET      { "$(FeatureReaderDataset_$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3)" } \
   QUERYFCT_IDS        { "" }                                          \
   READER_DIRECTIVES   { META_MACROS,SourceREADER_META_ATTRIBUTES<comma><quote>fme_dataset<space>fme_basename<quote><comma>SourceGROUP_BY_DATASET<comma>No<comma>SourceEXPOSE_ATTRS_GROUP<comma>FME_DISCLOSURE_OPEN<comma>SourceJPEG2000_EXPOSE_FORMAT_ATTRS<comma><quote>fme_basename<comma>char<openparen>50<closeparen><quote><comma>SourceUSE_SEARCH_ENVELOPE<comma>NO<comma>SourceSEARCH_ENVELOPE_MINX<comma>0<comma>SourceSEARCH_ENVELOPE_MINY<comma>0<comma>SourceSEARCH_ENVELOPE_MAXX<comma>0<comma>SourceSEARCH_ENVELOPE_MAXY<comma>0<comma>SourceSEARCH_ENVELOPE_COORDINATE_SYSTEM<comma><comma>SourceCLIP_TO_ENVELOPE<comma>NO<comma>SourceJPEG2000_RDR_ADV_PARM_GROUP<comma>FME_DISCLOSURE_OPEN<comma>SourcePREFER_FILE_CS_UNITS<comma>Yes<comma>SourceREAD_OFFSETS_IN_CS_UNITS<comma>No,METAFILE,JPEG2000 } \
   QUERYFCT_OUTPUT     { "BASED_ON_CONNECTIONS" }                      \
   CONTINUE_ON_READER_ERROR YES                                        \
   QUERYFCT_RESULT_TAGS { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_OUTPUT_PORTS_ENCODED) } \
   QUERYFCT_SET_FME_FEATURE_TYPE YES                                   \
   READER_PARAMS_WWJD                                                  \
    { $($(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_DIRECTIVES) } \
   TREAT_READER_PARAM_AMPERSANDS_AS_LITERALS YES                       \
   OUTPUT JPEG2000 FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_JPEG2000"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4      \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureReader_3_JPEG2000" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_0

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_1 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_0 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B01_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B01 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_1

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_2 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_1 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B02_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B02 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_2

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_3 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_2 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B03_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B03 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_3

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_4 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_3 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B04_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B04 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_4

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_5 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_4 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B05_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B05 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_5

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_6 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_5 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B06_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B06 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_6

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_7 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_6 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B07_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B07 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_7

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_8 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_7 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B08_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B08 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_8

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_9 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_8 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B8A_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B8A \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_9

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_10 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_9 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B09_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B09 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_10

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_11 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_10 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B10_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B10 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_11

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_12 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_11 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B11_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B11 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_12

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_13 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_12 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX B12_<backslash>d<backslash>dm ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B12 \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_13

FACTORY_DEF * TestFactory                                              \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_Condition_14 \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_13 \
CASE_SENSITIVE_TEST @EvaluateExpression(FDIV,STRING_ENCODED,<at>Value<openparen>fme_basename<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4) CONTAINS_REGEX TCI_10m ENCODED \
BOOLEAN_OPERATOR OR                                                    \
COMPOSITE_TEST_EXPR "<Unused>"                                         \
OUTPUT PASSED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TCI \
OUTPUT FAILED FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_14

FACTORY_DEF * TeeFactory                                               \
FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_<lt>UNFILTERED<gt> \
INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TESTFILTERINPUTLINE_14 \
OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_<lt>UNFILTERED<gt>

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4 <lt>UNFILTERED<gt> Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_<lt>UNFILTERED<gt>"

# -------------------------------------------------------------------------

FACTORY_DEF * XFMapFactory                                             \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_2   \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_PASSED_0_RcTV0oRQBVQ=" \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_6_PASSED_1_JvzDlcPjfkQ=" \
   XML_STREAM "xml_fragment"                                           \
   XFMAP_FEATURE_PATHS_EXPRESSION "@EvaluateExpression(FDIV,STRING_ENCODED,date<openbracket><at>name=<quote>ingestiondate<quote><closebracket>,$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_2)" \
   XFMAP_FEATURE_PATHS_STRUCTURE "<lf><lt>structure<space>separator=<quote>.<quote><space>map-empty-elements=<quote>yes<quote><space>matched-prefix=<quote>attributes<quote><space>matched-attributes=<quote>yes<quote><space>cardinality=<quote>+<opencurly>?<closecurly><quote><space>structure-prefix=<quote><quote><space>child-position-attribute=<quote><quote><space>except-expression=<quote><quote><space>ui-mode=<quote>basic<quote><space>matched-ancestor-attributes=<quote><quote><solidus><gt><lf>" \
   MERGE_ATTRIBUTES_FROM_INPUT Yes                                     \
   REJECT_FEATURES_WITH_NO_FRAGMENTS YES                               \
   OUTPUT MAPPED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_2_FRAGMENTS"

# -------------------------------------------------------------------------

DEFAULT_MACRO __$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_GROUP_BY

# If the cumulative port is connected, the _PORT_SPECIFIED macro

MACRO $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_PORT_SPECIFIED no

# Force splitting of feature tables when the CUMULATIVE port is connected

MACRO $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_SPLIT_FEATURE_TABLES Yes

INCLUDE [if { {$($(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_PORT_SPECIFIED)} == "no" } { \
    puts {MACRO $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_SPLIT_FEATURE_TABLES No} \
}

DYNAMIC_FUNCTION_CONFIGURATION Python FMEOBJECTS

DYNAMIC_FUNCTION_CONFIGURATION Python import StatisticsCalculator

DYNAMIC_FUNCTION_CONFIGURATION Python "StatisticsCalculator.connectTransformer( \
   '$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator',{       \
    'GROUP_BY_MACRO':'__$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_GROUP_BY', \
    'STATS_ATTRS':'xml_matched_element',                               \
    'COUNT_ATTR':'_count',                                             \
    'COMPUTE_HISTOGRAM':'NO',                                          \
    'HISTO_ATTR':'<Unused>',                                           \
    'PREPEND_ATTR_NAME':'No',                                          \
    'encoded_result_attrs':True,                                       \
    'cumulative_mode':'$($(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_PORT_SPECIFIED)', \
    None:None})"

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_InputProcessor \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_XMLFragmenter_2_FRAGMENTS" \
   SPLIT_FEATURE_TABLES $($(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_97eef9be_998f_47d0_a456_03be24f1e3040_SPLIT_FEATURE_TABLES) \
   OUTPUT FEATURE_TYPE __ORIGINAL__                                    \
      @Python(StatisticsCalculator.recordFeature,$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator)

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_UnneededInputNuker \
   INPUT FEATURE_TYPE __ORIGINAL__                                     \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_COMPLETE"

FACTORY_DEF * SortFactory                                              \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_CompleteOutputter \
   INPUT FEATURE_TYPE __UNUSED_INPUT_TO_GUARANTEE_FACTORY_DOESNT_CONSUME_EVERYTHING__ \
   INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_COMPLETE" \
   OUTPUT SORTED FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_COMPLETE" \
      @Python(StatisticsCalculator.summarizeStatistics,$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator,__ORIGINAL__)

FACTORY_DEF * CreationFactory                                          \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SummaryCreator \
   CREATE_AT_END                                                       \
   NUMBER_TO_CREATE 1                                                  \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SUMMARY"

FACTORY_DEF * ElementFactory                                           \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SummaryExploder \
   LIST_NAME $(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_stats{} \
   MODE LEAN_AND_MEAN                                                  \
   CLONE_GEOMETRY no                                                   \
   INPUT FEATURE_TYPE __UNUSED_INPUT_TO_GUARANTEE_FACTORY_DOESNT_CONSUME_EVERYTHING__ \
   INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SUMMARY" \
      @Python(StatisticsCalculator.summarizeStatistics,$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator,__SINGLE_GUY__) \
   OUTPUT ELEMENT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SUMMARY" \
      @Geometry(FIX_FMETYPE_FMEGEOMETRY)

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_ListBuilder_fme_type_remover \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_COMPLETE" \
   OUTPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_ListBuilder_no_fme_type \
      @RemoveAttributes(fme_type,fme_geometry)

FACTORY_DEF {*} ListFactory                                            \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_ListBuilder       \
   INPUT FEATURE_TYPE $(SentinelDownloader_WORKSPACE_NAME)_ListBuilder_no_fme_type \
   LIST_NAME "_datelist{}"                                             \
   LIST_ATTRS_TO_INCLUDE { date }                                      \
   LIST_ATTRS_TO_INCLUDE_MODE SELECTED                                 \
   ORDERED_BY_GROUP No                                                 \
   OUTPUT LIST FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ListBuilder_OUTPUT"

# -------------------------------------------------------------------------

Tcl2 set $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__separator [FME_DecodeText {<space><amp><space>}]; \
     regsub -all \"{}\" [FME_DecodeText {_datelist<opencurly><closecurly>.date}] [FME_DecodeText {<opencurly><backslash>d+<closecurly>}] $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__listPattern; \
     set $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__listPattern ^$$(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__listPattern$;

Tcl2 proc $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__Concatenate {} { \
  upvar \#0 $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__separator separator \
            $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__listPattern listPattern; \
  set allAttrs [lsort -dictionary [FME_AttributeNames]];               \
  set keepEmptyParts [string equal {No} {No}];                         \
  set result {};                                                       \
  foreach attrName $allAttrs {                                         \
    if {[regexp $listPattern $attrName]} {                             \
      set attrValue [FME_GetAttribute $attrName];                      \
      if {$keepEmptyParts || $attrValue != {}} {                       \
        lappend result $attrValue;                                     \
      };                                                               \
    };                                                                 \
  };                                                                   \
  FME_SetAttribute {"_concatenated"} [join $result $separator];        \
}

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator  \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ListBuilder_OUTPUT" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator_OUTPUT" \
        @Tcl2($(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator__Concatenate)

# -------------------------------------------------------------------------

INCLUDE [if { {ATTRIBUTES} == {ATTRIBUTES} } {                         \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO ATTRIBUTES"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_BUILD} && {POLYGONS} == {POLYGONS}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_BUILD_POLYS"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_BUILD} && {POLYGONS} == {AGGREGATES}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_BUILD_AGGREGATES"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_BUILD} && {POLYGONS} == {LINESFROMPOINTS}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_BUILD_LINES_FROM_POINTS"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_AND_ATTRS} && {POLYGONS} == {POLYGONS}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_AND_ATTR_BUILD_POLYS"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_AND_ATTRS} && {POLYGONS} == {AGGREGATES}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_AND_ATTR_BUILD_AGGREGATES"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_AND_ATTRS} && {POLYGONS} == {LINESFROMPOINTS}} { \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_AND_ATTR_BUILD_LINES_FROM_POINTS"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_BUILD} } {                     \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_BUILD_AGGREGATES"; \
            }                                                          \
         elseif { {ATTRIBUTES} == {GEOM_AND_ATTRS} } {                 \
               puts "MACRO $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO GEOM_AND_ATTR_BUILD_AGGREGATES"; \
            }                                                          \
         else {};                                                      \
]

FACTORY_DEF {*} ReferenceFactory                                       \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger     \
   INPUT REFERENCER FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_StatisticsCalculator_SUMMARY" \
   INPUT REFERENCEE FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_ListConcatenator_OUTPUT" \
   CONNECT_Z_MODE FIRST_WINS                                           \
   REFERENCE_INFO $($(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_REFERENCE_INFO) \
   REFERENCE_TABLE 1 1 AUTO                                            \
   ATTR_ACCUM_MODE "HANDLE_CONFLICT"                                   \
   ATTR_CONFLICT_RES "REQUESTOR_IF_CONFLICT"                           \
   IGNORE_NULLS "No"                                                   \
   HANDLE_NULL_MISSING_KEYS_LIKE_FME2013 No                            \
   LIST_ATTRS_TO_INCLUDE { <Unused> }                                  \
   LIST_ATTRS_TO_INCLUDE_MODE <Unused>                                 \
   MERGE_ATTRIBUTES Yes                                                \
   MANAGE_FME_TYPE Yes                                                 \
   MODE COMPLETE                                                       \
   PROCESS_DUPLICATE_REFERENCEES YES                                   \
   REFERENCEES_FIRST No                                                \
   REJECT_INVALID_GEOM YES                                             \
   CLEANING_TOLERANCE NONE                                             \
   OUTPUT COMPLETE FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_MERGED"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Logger_Logger     \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_FeatureMerger_MERGED" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_LOGGED" \
                 @Log(ENCODED, "<dollar><openparen>SentinelDownloader_WORKSPACE_NAME<closeparen>_Logger:<space>@EvaluateExpression(FDIV,STRING_ENCODED,Your<space>request<space>delivers<space><at>Value<openparen>_count<closeparen><space>result<openparen>s<closeparen>.<lf>The<space>request<space>delivers<space>images<space>at<space>the<space>following<space>dates:<space><at>Value<openparen>_concatenated<closeparen>,$(SentinelDownloader_WORKSPACE_NAME)_Logger)","<Unused>","100","",WARN,NONE,$(SentinelDownloader_WORKSPACE_NAME)_Logger_142b58a1_a992_4b46_9ed1_0687e761510b0)

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Logger LOGGED Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_LOGGED"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME $(SentinelDownloader_WORKSPACE_NAME)_Logger_2_Logger   \
   INPUT  FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Tester_FAILED" \
   OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_2_LOGGED" \
                 @Log(ENCODED, "<dollar><openparen>SentinelDownloader_WORKSPACE_NAME<closeparen>_Logger_2:<space>Unfortunately<comma><space>there<space>is<space>no<space>L2A<space>data<space>availabe.<space>Try<space>to<space>choose<space>the<space>option<space><quote>Level<space>1C<quote><space>at<space>the<space><quote>Product<space>Level<quote><space>parameter.","<Unused>","20","",WARN,NONE,$(SentinelDownloader_WORKSPACE_NAME)_Logger_2_b3452104_c4c2_4a6b_a1f1_e407cf7f36020)

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Logger_2 LOGGED Transformer Output Nuker" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Logger_2_LOGGED"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_11610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B01" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B01" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_1"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_21610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B02" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B02" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_2"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_31610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B03" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B03" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_3"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_41610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B04" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B04" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_4"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_51610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B05" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B05" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_5"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_61610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B06" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B06" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_6"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_71610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B07" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B07" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_7"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_81610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B08" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B08" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_8"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_91610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B09" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B09" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_9"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_101610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B10" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B10" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_10"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_111610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B11" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B11" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_11"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_121610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B12" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B12" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_12"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_Band_8A1610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_B8A" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_B8A" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_Band_8A"

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "$(SentinelDownloader_WORKSPACE_NAME)_TCI1610612239 Output Collector" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_4_TCI" \
  INPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TestFilter_5_TCI" \
  OUTPUT FEATURE_TYPE "$(SentinelDownloader_WORKSPACE_NAME)_TCI"

INCLUDE [puts {MACRO WB_CURRENT_CONTEXT $(WB_OLD_CONTEXT_$(SentinelDownloader_WORKSPACE_NAME))}]

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_1 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_1

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_2 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_2

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_3 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_3

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_4 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_4                         \
  OUTPUT FEATURE_TYPE SentinelDownloader_Band_4

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_5 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_5

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_6 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_6

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_7 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_7

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_8 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_8                         \
  OUTPUT FEATURE_TYPE SentinelDownloader_Band_8

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_8A Output Renamer/Nuker"       \
  INPUT FEATURE_TYPE SentinelDownloader_Band_8A

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_9 Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE SentinelDownloader_Band_9

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_10 Output Renamer/Nuker"       \
  INPUT FEATURE_TYPE SentinelDownloader_Band_10

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_11 Output Renamer/Nuker"       \
  INPUT FEATURE_TYPE SentinelDownloader_Band_11

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader Band_12 Output Renamer/Nuker"       \
  INPUT FEATURE_TYPE SentinelDownloader_Band_12

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "SentinelDownloader TCI Output Renamer/Nuker"           \
  INPUT FEATURE_TYPE SentinelDownloader_TCI

# -------------------------------------------------------------------------

# If we're doing LAST N features, then the multiplier comes in as 0.

# If we're doing First N, multiplier is -1.

# For RANDOM, we need to treat LAST N as if it was first N (i.e. have a -1)

# That is what the ? : does in the rate multiplier.

INCLUDE [ if { {-1} == {0} && {ORIGINAL} == {ORIGINAL} } {             \
             puts "MACRO REAL_MODE LAST";                              \
	         puts "MACRO REAL_RATE 1";                                    \
	      } else {                                                        \
             puts "MACRO REAL_MODE ORIGINAL";                          \
             puts "MACRO REAL_RATE [expr 1 * ( -1 ? -1 : -1 ) ]";      \
	      } ]

FACTORY_DEF {*} SamplingFactory                                        \
   FACTORY_NAME Sampler_2                                              \
   COMMAND_PARM_EVALUATION SINGLE_PASS                                 \
   SAMPLE_RATE $(REAL_RATE)                                            \
   SAMPLE_ORDER $(REAL_MODE)                                           \
   FLUSH_WHEN_GROUPS_CHANGE No                                         \
   INPUT  FEATURE_TYPE SentinelDownloader_Band_8                       \
   OUTPUT SAMPLED FEATURE_TYPE ___SAMPLED___

# This TeeFactory is needed because Sampler will still output features if it has no OUTPUT clauses specified.

# This way we behave nicely even if there are no output connections on the transformer. See PR#28886.

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME Sampler_2_Sampled                                      \
   INPUT FEATURE_TYPE ___SAMPLED___                                    \
   OUTPUT FEATURE_TYPE Sampler_2_SAMPLED

# -------------------------------------------------------------------------

# If we're doing LAST N features, then the multiplier comes in as 0.

# If we're doing First N, multiplier is -1.

# For RANDOM, we need to treat LAST N as if it was first N (i.e. have a -1)

# That is what the ? : does in the rate multiplier.

INCLUDE [ if { {-1} == {0} && {ORIGINAL} == {ORIGINAL} } {             \
             puts "MACRO REAL_MODE LAST";                              \
	         puts "MACRO REAL_RATE 1";                                    \
	      } else {                                                        \
             puts "MACRO REAL_MODE ORIGINAL";                          \
             puts "MACRO REAL_RATE [expr 1 * ( -1 ? -1 : -1 ) ]";      \
	      } ]

FACTORY_DEF {*} SamplingFactory                                        \
   FACTORY_NAME Sampler                                                \
   COMMAND_PARM_EVALUATION SINGLE_PASS                                 \
   SAMPLE_RATE $(REAL_RATE)                                            \
   SAMPLE_ORDER $(REAL_MODE)                                           \
   FLUSH_WHEN_GROUPS_CHANGE No                                         \
   INPUT  FEATURE_TYPE SentinelDownloader_Band_4                       \
   OUTPUT SAMPLED FEATURE_TYPE ___SAMPLED___

# This TeeFactory is needed because Sampler will still output features if it has no OUTPUT clauses specified.

# This way we behave nicely even if there are no output connections on the transformer. See PR#28886.

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME Sampler_Sampled                                        \
   INPUT FEATURE_TYPE ___SAMPLED___                                    \
   OUTPUT FEATURE_TYPE Sampler_SAMPLED

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "NDVICalculator Red Input Collector"                    \
  INPUT FEATURE_TYPE Sampler_SAMPLED                                   \
  OUTPUT FEATURE_TYPE NDVICalculator_Red

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "NDVICalculator Infrared Input Collector"               \
  INPUT FEATURE_TYPE Sampler_2_SAMPLED                                 \
  OUTPUT FEATURE_TYPE NDVICalculator_Infrared

MACRO NDVICalculator_WORKSPACE_NAME NDVICalculator

MACRO $(NDVICalculator_WORKSPACE_NAME)_XFORMER_NAME NDVICalculator

MACRO $(NDVICalculator_WORKSPACE_NAME)_TRANSFORMER_GROUP 

MACRO $(NDVICalculator_WORKSPACE_NAME)___COMPOUND_PARAMETERS 

MACRO $(NDVICalculator_WORKSPACE_NAME)_INDEXTYPE NDVI

MACRO $(NDVICalculator_WORKSPACE_NAME)_SAVIADJUSTMENT 0.5

MACRO $(NDVICalculator_WORKSPACE_NAME)_COLORIZE Red-Yellow-Blue-Green Palette

MACRO $(NDVICalculator_WORKSPACE_NAME)_GROUP_BY 

INCLUDE_CUSTOM_TRANSFORMER_VER NDVICalculator:2

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "NDVICalculator Output Output Renamer/Nuker"            \
  INPUT FEATURE_TYPE NDVICalculator_Output                             \
  OUTPUT FEATURE_TYPE NDVICalculator_Output

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "NDVICalculator <Rejected> Output Renamer/Nuker"        \
  INPUT FEATURE_TYPE NDVICalculator_<Rejected>

# -------------------------------------------------------------------------

# Wipe out the source setting if it was untouched from the default setting

DEFAULT_MACRO Reprojector_SOURCE "Read from feature"

INCLUDE [if { {Read from feature} == {Read from feature} } {           \
            puts {MACRO Reprojector_SOURCE}                            \
         }                                                             \
        ]

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME Reprojector                                            \
   INPUT  FEATURE_TYPE NDVICalculator_Output                           \
   OUTPUT FEATURE_TYPE Reprojector_REPROJECTED                         \
        @Reproject($(Reprojector_SOURCE),"LL-WGS84",NearestNeighbor,PreserveCells,Reprojector,"COORD_SYS_WARNING",RASTER_TOLERANCE,0.0)

# -------------------------------------------------------------------------

INCLUDE [                                                              \
   if {($(FME_BUILD_NUM) < 5669) || [FME_ComponentIsLicensed -factory RasterClippingFactory]} { \
      puts "MACRO RASTER_CLIPPER_IN *";                                \
   } else {                                                            \
      puts "MACRO RASTER_CLIPPER_IN NOT_THIS_TIME";                    \
   }                                                                   \
]

# The dummy input feature type Clipper___ClipperMakeSureWeDontGetAllFeatures___

# makes sure that if INPUT  FEATURE_TYPE Tester_PASSED_1_8t6d0F2OYOU=  \
 is emtpy, we don't get every feature

# sent into this factory.

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME Clipper_ClipperCloner                                  \
   INPUT  FEATURE_TYPE Tester_PASSED_1_8t6d0F2OYOU=                    \
   INPUT FEATURE_TYPE Clipper___ClipperMakeSureWeDontGetAllFeatures___ \
   OUTPUT FEATURE_TYPE Clipper___ClippersForSolidOrVector___           \
   OUTPUT FEATURE_TYPE Clipper___ClippersForRaster___

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME Clipper_SolidClipperFilter                             \
   INPUT FEATURE_TYPE Clipper___ClippersForSolidOrVector___            \
   TEST &fme_type == "fme_solid"                                       \
   OUTPUT FAILED FEATURE_TYPE Clipper___ClippersForVector___           \
   OUTPUT PASSED FEATURE_TYPE Clipper___ClippersForSolid___

# The dummy input feature type Clipper___ClippeeMakeSureWeDontGetAllFeatures___

# makes sure that if INPUT  FEATURE_TYPE Reprojector_REPROJECTED       \
 is emtpy, we don't get every feature

# sent into this factory.

FACTORY_DEF * TestFactory                                              \
   FACTORY_NAME Clipper_ClippeeFilter                                  \
   INPUT  FEATURE_TYPE Reprojector_REPROJECTED                         \
   INPUT FEATURE_TYPE Clipper___ClippeeMakeSureWeDontGetAllFeatures___ \
   TEST &fme_type == "fme_raster"                                      \
   OUTPUT FAILED FEATURE_TYPE Clipper___VectorOrSolidClippees___       \
   OUTPUT PASSED FEATURE_TYPE Clipper___RasterClippees___

FACTORY_DEF {$(RASTER_CLIPPER_IN)} RasterClippingFactory               \
   FACTORY_NAME Clipper_Raster                                         \
   INPUT CLIPPER FEATURE_TYPE Clipper___ClippersForRaster___           \
   INPUT CLIPPEE FEATURE_TYPE Clipper___RasterClippees___              \
   MULTICLIP YES                                                       \
   MERGE_CLIPPER_ATTRIBUTES NO                                         \
   ATTR_ACCUM_MODE "<Unused>"                                          \
   ATTR_CONFLICT_RES "<Unused>"                                        \
   CLIPPER_PREFIX "<Unused>"                                           \
   PRESERVE_CLIPPEE_EXTENTS NO                                         \
   FLUSH_WHEN_GROUPS_CHANGE No                                         \
   OUTPUT_NO_CLIPPERS_AS_OUTSIDE                                       \
   OUTSIDE_NO_CLIPPERS_ATTR _fme_no_clipper                            \
   OUTPUT INSIDE FEATURE_TYPE Clipper_INSIDE                           \
       "_clipped" no                                                   \
   OUTPUT CLIPPED_INSIDE FEATURE_TYPE Clipper_INSIDE                   \
       "_clipped" yes                                                  \
   OUTPUT EXTRA_CLIPPER FEATURE_TYPE Clipper__delete__ @Tcl2("FME_LogMessage fme_warn 917351 Clipper")

FACTORY_DEF {*} ClippingFactory                                        \
   FACTORY_NAME Clipper_Vector                                         \
   INPUT CLIPPER FEATURE_TYPE Clipper___ClippersForVector___           \
   INPUT CLIPPEE FEATURE_TYPE Clipper___VectorOrSolidClippees___       \
   INPUT CLIPPEE FEATURE_TYPE Clipper___RasterClippees___              \
   MULTICLIP YES                                                       \
   CONNECT_Z_MODE <Unused>                                             \
   MISSING_VAL_MODE COMPUTE_NANS                                       \
   COMPUTE_MEASURES_MODE CONTINUOUS                                    \
   MEASURES_AND_Z_FROM CLIPPEE                                         \
   CLIPPEE_ON_BOUNDARY INSIDE                                          \
   MERGE_CLIPPER_ATTRIBUTES NO                                         \
   ATTR_ACCUM_MODE "<Unused>"                                          \
   ATTR_CONFLICT_RES "<Unused>"                                        \
   CLIPPER_PREFIX "<Unused>"                                           \
   OUTPUT_NO_CLIPPERS_AS_OUTSIDE                                       \
   OUTSIDE_NO_CLIPPERS_ATTR _fme_no_clipper                            \
   LINES_AS_SEGMENTS    NO                                             \
   FLUSH_WHEN_GROUPS_CHANGE No                                         \
   MODE COMPLETE                                                       \
   CLEANING_TOLERANCE AUTO                                             \
   OUTPUT INSIDE FEATURE_TYPE Clipper_INSIDE                           \
       "_clipped" no                                                   \
   OUTPUT CLIPPED_INSIDE FEATURE_TYPE Clipper_INSIDE                   \
       "_clipped" yes                                                  \
   OUTPUT OUTSIDE_NO_CLIPPER FEATURE_TYPE Clipper___ClippeeForSolid___ \
   OUTPUT EXTRA_CLIPPER   FEATURE_TYPE Clipper__delete__ @Tcl2("FME_LogMessage fme_warn 917351 Clipper") \
   OUTPUT NONPOLY_CLIPPER FEATURE_TYPE Clipper__delete__ @Tcl2("FME_LogMessage fme_warn 917352 Clipper")

FACTORY_DEF {*} SolidIntersectionFactory                               \
   FACTORY_NAME Clipper_Solid                                          \
   INPUT CLIPPER FEATURE_TYPE Clipper___ClippersForSolid___            \
   INPUT CLIPPEE FEATURE_TYPE Clipper___ClippeeForSolid___             \
   MULTICLIP YES                                                       \
   CLIPPEE_ON_BOUNDARY INSIDE                                          \
   MERGE_CLIPPER_ATTRIBUTES NO                                         \
   ATTR_ACCUM_MODE "<Unused>"                                          \
   ATTR_CONFLICT_RES "<Unused>"                                        \
   CLIPPER_PREFIX "<Unused>"                                           \
   OUTPUT_NO_CLIPPERS_AS_OUTSIDE                                       \
   OUTSIDE_NO_CLIPPERS_ATTR _fme_no_clipper                            \
   FLUSH_WHEN_GROUPS_CHANGE No                                         \
   OUTPUT INSIDE FEATURE_TYPE Clipper_INSIDE                           \
       "_clipped" no                                                   \
   OUTPUT CLIPPED_INSIDE FEATURE_TYPE Clipper_INSIDE                   \
       "_clipped" yes                                                  \
   OUTPUT EXTRA_CLIPPER   FEATURE_TYPE Clipper__delete__ @Tcl2("FME_LogMessage fme_warn 917351 Clipper")

FACTORY_DEF * TeeFactory                                               \
   FACTORY_NAME Clipper_Nuker                                          \
   INPUT FEATURE_TYPE Clipper__delete__                                \
      @Log("Offending feature was:")

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "Clipper INSIDE Splitter"                               \
  INPUT FEATURE_TYPE Clipper_INSIDE                                    \
  OUTPUT FEATURE_TYPE Clipper_INSIDE_0_PMBiwD96aMs=                    \
  OUTPUT FEATURE_TYPE Clipper_INSIDE_1_WdTwwzY43qU=

# -------------------------------------------------------------------------

FACTORY_DEF * RasterStatisticsFactory                                  \
   FACTORY_NAME RasterStatisticsCalculator                             \
   INPUT  FEATURE_TYPE Clipper_INSIDE_0_PMBiwD96aMs=                   \
   RASTER_LEVEL BAND_ONLY                                              \
   RASTER_STATS 0   MEAN   STDEV                                       \
   OUTPUT OUTPUT FEATURE_TYPE RasterStatisticsCalculator_OUTPUT

# -------------------------------------------------------------------------

FACTORY_DEF * RoutingFactory FACTORY_NAME "Destination Feature Type Routing Correlator" \
  COMMAND_PARM_EVALUATION SINGLE_PASS                                  \
  INPUT FEATURE_TYPE *                                                 \
   ROUTE FME_GENERIC RasterStatisticsCalculator_OUTPUT TO CSV2 __GO_TO_FINAL_OUTPUT_ROUTER__ multi_writer_id,0,<at>SupplyAttributes<openparen>ENCODED<comma>__wb_out_feat_type__<comma>StatisticOutput<closeparen> GEOMETRY \
   ROUTE FME_GENERIC Clipper_INSIDE_1_WdTwwzY43qU= TO TIFF __GO_TO_FINAL_OUTPUT_ROUTER__ multi_writer_id,1,<at>SupplyAttributes<openparen>ENCODED<comma>__wb_out_feat_type__<comma>tiff<closeparen> GEOMETRY \
  FEATURE_TYPE_ATTRIBUTE __wb_out_feat_type__                          \
  OUTPUT ROUTED FEATURE_TYPE *                                         \
  OUTPUT NOT_ROUTED FEATURE_TYPE __nuke_me__ @Tcl2("FME_StatMessage 818059 [FME_GetAttribute fme_template_feature_type] 818060 818061 fme_warn")

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory                                               \
  FACTORY_NAME "Final Output Nuker"                                    \
  INPUT FEATURE_TYPE __nuke_me__


# -------------------------------------------------------------------------
CSV2_1_DEF StatisticOutput                                             \
  csv_existing_file_handling   Yes                                     \
  csv_write_field_names        firstrow                                \
  _clipped                     string                                  \
  band0.mean                   real64                                  \
  band0.stdev                  real64

# -------------------------------------------------------------------------
TIFF_1_DEF tiff                                                        \
  tiff_world_file_generation   yes                                     \
  tiff_create_tiled_files      no                                      \
  tiff_tile_size_x             ""                                      \
  tiff_tile_size_y             ""                                      \
  tiff_compression_method      none                                    \
  tiff_jpeg_compression_level  25                                      \
  tiff_tab_file_generation     no                                      \
  tiff_number_of_bits_per_cell ""                                      \
  tiff_enable_bigtiff          no                                      \
  tiff_interleaving_type       BIP                                     \
  tiff_photometric_interpretation Auto                                 \
  tiff_byte_order              machine                                 \
  tiff_calculate_minmax_tifftags no                                    \
  tiff_generate_pyramids       NO                                      \
  _clipped                     char(200)

